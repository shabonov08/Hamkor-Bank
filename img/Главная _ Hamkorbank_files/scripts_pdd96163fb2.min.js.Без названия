const body=document.body;const navbar=body.querySelector('.navbar');const mainWrapper=body.querySelector('.main-wrapper');const navbarTopLine=body.querySelector('.navbar__top-line');const navbarContainer=body.querySelector('.navbar .container');const dropdownsObject={}
if(navbar){var navbarRect=navbar.getBoundingClientRect(),navbarTopLineRect=navbarTopLine.getBoundingClientRect(),navbarContainerRect=navbarContainer.getBoundingClientRect();}else{var navbarRect={},navbarTopLineRect={},navbarContainerRect={};}const searchPopup=document.querySelector('.search-popup');var remSize=getRemSize();function setCookie(name,value,days){var expires="";if(days){var date=new Date();date.setTime(date.getTime()+(days*24*60*60*1000));expires="; expires="+date.toUTCString();}document.cookie=name+"="+(value||"")+expires+"; path=/";}function getCookie(name){var nameEQ=name+"=";var ca=document.cookie.split(';');for(var i=0;i<ca.length;i++){var c=ca[i];while(c.charAt(0)==' ')c=c.substring(1,c.length);if(c.indexOf(nameEQ)==0)return c.substring(nameEQ.length,c.length);}return null;}function eraseCookie(name){document.cookie=name+'=; Max-Age=-99999999;';}const searchDesktopToggle=document.querySelectorAll('.search-open');const searchPopupClose=document.querySelectorAll(
'.search-popup-close');const searchOverlay=document.querySelector('.search-popup-overlay');Array.prototype.forEach.call(searchDesktopToggle,(searchButton)=>{searchButton.addEventListener('click',()=>{searchPopup.style.display="block";searchOverlay.style.display="block";bodyScrollControls.disable();const searchPopupRect=searchPopup.getBoundingClientRect();searchPopup.style.top=navbarRect.top+navbarRect.height+'px';searchPopup.classList.add('is--open');searchOverlay.classList.remove('opacity-0');searchOverlay.classList.add('opacity-100');});});Array.prototype.forEach.call(searchPopupClose,(closeButton)=>{closeButton.addEventListener('click',()=>{searchPopup.classList.remove('is--open');searchOverlay.classList.add('opacity-0');searchOverlay.classList.remove('opacity-100');bodyScrollControls.enable();setTimeout(()=>{searchPopup.style.display="none";searchOverlay.style.display="none";},500)})});const disabilitiesDesktopToggle=document.querySelector('[data-disabilities-popup-xl-open]');const
disabilitiesMobileToggle=document.querySelector('[data-disabilities-popup-sm-open]');const disabilitiesPopupClose=document.querySelectorAll('[data-disabilities-close]');const disabilitiesPopup=document.querySelector('.disabilities-popup');const disabilitiesGrayscaleRadio=document.querySelectorAll('[name="disabilities-color"]');const disabilitiesClearBtn=document.querySelector('[data-disabilities-clear]');const disabilitiesFontMin=document.querySelector('.disabilities-popup [data-range-min]');const disabilitiesFontMax=document.querySelector('.disabilities-popup [data-range-max]');const disabilitiesPopupCloseFunc=()=>{disabilitiesPopup.classList.remove('is--open');disabilitiesDesktopToggle.classList.remove('is--open');disabilitiesMobileToggle.classList.remove('is--open');setTimeout(()=>{disabilitiesPopup.style.display="none";},500)}
$('.disabilities-popup .input-slider').slider({range:"min",value:100,step:5,min:80,max:120,animate:300,change:function(event,ui){document.querySelector(':root').style.setProperty('--sizeFactor',ui.value/100);setCookie("disabilitiesFontSize",ui.value/100,7);},slide:function(event,ui){document.querySelector(':root').style.setProperty('--sizeFactor',ui.value/100);setCookie("disabilitiesFontSize",ui.value/100,7);}});window.addEventListener('mousedown',(e)=>{if(!disabilitiesPopup.classList.contains('is--open')){return;}if(!$(e.target).closest(".disabilities-popup").length){disabilitiesPopupCloseFunc();}});if(getCookie("disabilitiesGrayscale")){document.documentElement.classList.add('is--grayscale');disabilitiesGrayscaleRadio[1].checked=true;}if(getCookie("disabilitiesFontSize")){var fontSize=getCookie("disabilitiesFontSize");document.querySelector(':root').style.setProperty('--sizeFactor',fontSize);var sliderFontSize=parseFloat(fontSize)*100
$('.disabilities-popup .input-slider').slider('value',sliderFontSize);}disabilitiesClearBtn.addEventListener('click',(e)=>{document.documentElement.classList.remove('is--grayscale');document.querySelector(':root').style.setProperty('--sizeFactor',1);disabilitiesGrayscaleRadio[0].checked=true;$('.disabilities-popup .input-slider').slider('value',100);setCookie("disabilitiesGrayscale",false,7);setCookie("disabilitiesFontSize",1,7);eraseCookie("disabilitiesGrayscale");eraseCookie("disabilitiesFontSize");})
disabilitiesFontMin.addEventListener('click',(e)=>{$('.disabilities-popup .input-slider').slider('value',80);});disabilitiesFontMax.addEventListener('click',(e)=>{$('.disabilities-popup .input-slider').slider('value',120);})
Array.prototype.forEach.call(disabilitiesGrayscaleRadio,(radio)=>{radio.addEventListener("change",()=>{if(radio.checked&&radio.value=="gray"){document.documentElement.classList.add('is--grayscale');setCookie("disabilitiesGrayscale",true,7);}else{document.documentElement.classList.remove('is--grayscale');setCookie("disabilitiesGrayscale",false,7);eraseCookie("disabilitiesGrayscale");}})})
const setDisabilitiesPopupPosition=()=>{const disabilitiesPopupRect=disabilitiesPopup.getBoundingClientRect();const disabilitiesDesktopToggleRect=disabilitiesDesktopToggle.getBoundingClientRect();if(window.innerWidth>767){disabilitiesPopup.style.top=navbarTopLineRect.top+navbarTopLineRect.height+'px';disabilitiesPopup.style.left=disabilitiesDesktopToggleRect.left+disabilitiesDesktopToggleRect.width/2-disabilitiesPopupRect.width/2+'px';}else{disabilitiesPopup.style.top=navbarRect.top+navbarRect.height-1+'px';disabilitiesPopup.style.left=0}}
disabilitiesDesktopToggle.addEventListener('click',()=>{if(!disabilitiesDesktopToggle.classList.contains('is--open')){disabilitiesPopup.style.display="block";setDisabilitiesPopupPosition();disabilitiesPopup.classList.add('is--open');disabilitiesDesktopToggle.classList.add('is--open');disabilitiesMobileToggle.classList.add('is--open');}});disabilitiesMobileToggle.addEventListener('click',()=>{if(!disabilitiesMobileToggle.classList.contains('is--open')){disabilitiesPopup.style.display="block";setDisabilitiesPopupPosition();disabilitiesPopup.classList.add('is--open');disabilitiesDesktopToggle.classList.add('is--open');disabilitiesMobileToggle.classList.add('is--open');}});Array.prototype.forEach.call(disabilitiesPopupClose,(closeTrigger)=>{closeTrigger.addEventListener('click',()=>{disabilitiesPopupCloseFunc();});});const navbarMobileMainLinks=document.querySelectorAll('.navbar__menu-mobile-btn');const navbarMobileMainMenus=document.querySelectorAll('.navbar__menu');Array.prototype.
forEach.call(navbarMobileMainLinks,(link,idx)=>{link.addEventListener('click',(e)=>{e.preventDefault();link.classList.add('w--current');link.scrollIntoView({behavior:"smooth",block:"nearest",inline:"nearest"});if(idx==0){document.querySelector('.navbar__menu-mobile-wrap').scrollTo({left:0,behavior:"smooth"})}Array.prototype.forEach.call(navbarMobileMainMenus,(menu,menuIdx)=>{if(menuIdx!==idx){menu.classList.add("sm--opacity-0","sm--invisible","sm--translate-y-10");setTimeout(()=>{menu.classList.remove("sm--flex");menu.classList.add("sm--hidden");},300)}})
setTimeout(()=>{navbarMobileMainMenus[idx].classList.remove('sm--hidden');navbarMobileMainMenus[idx].classList.add("sm--flex");setTimeout(()=>{navbarMobileMainMenus[idx].classList.remove("sm--invisible","sm--opacity-0","sm--translate-y-10");},10)},300)
Array.prototype.forEach.call(navbarMobileMainLinks,(anotherLink)=>{if(anotherLink!==link){anotherLink.classList.remove('w--current');}});})})
function handleScrollToSection(e){e.preventDefault();let targetId=e.currentTarget.getAttribute('href').substring(1);let targetElement=document.getElementById(targetId);if(targetElement){let targetOffset=targetElement.offsetTop-navbarRect.height;window.scrollTo({top:targetOffset,behavior:'smooth'});}}function scrollToSection(reassign){let anchorLinks=document.querySelectorAll('a[href^="#"], a[href="#"]');Array.prototype.forEach.call(anchorLinks,(link)=>{if(link.getAttribute('href').length>4){if(reassign){link.removeEventListener('click',handleScrollToSection);}link.addEventListener('click',handleScrollToSection)}else{link.addEventListener('click',(e)=>{e.preventDefault();});}})}scrollToSection();window.addEventListener('resize',()=>{navbarRect=navbar.getBoundingClientRect();navbarTopLineRect=navbarTopLine.getBoundingClientRect(),navbarContainerRect=navbarContainer.getBoundingClientRect();remSize=getRemSize();if(disabilitiesPopup&&disabilitiesPopup.classList.contains('is--open')){
setDisabilitiesPopupPosition();}})
function getRemSize(){return getComputedStyle(document.documentElement).getPropertyValue('--remSize');}var os=platform.os.family;function getOS(){"use strict";var userAgent=window.navigator.userAgent,platform=window.navigator.userAgentData?window.navigator.userAgentData:window.navigator.platform||window.navigator.platform,macosPlatforms=['Macintosh','MacIntel','MacPPC','Mac68K','macOS'],windowsPlatforms=['Win32','Win64','Windows','WinCE'],iosPlatforms=['iPhone','iPad','iPod'],os=null;if(macosPlatforms.indexOf(platform)!==-1){os='OS X';}else if(iosPlatforms.indexOf(platform)!==-1){os='iOS';}else if(windowsPlatforms.indexOf(platform)!==-1){os='Windows';}else if(/Huawei/.test(userAgent)){os='Huawei';}else if(/Android/.test(userAgent)){os='Android';}else if(/Linux/.test(platform)){os='Linux';}return os;}function iOS(){"use strict";return['iPad Simulator','iPhone Simulator','iPod Simulator','iPad','iPhone','iPod'].includes(navigator.platform)||(navigator.userAgent.includes("Mac")&&
"ontouchend"in document)}if(os===null||os=='Android'){os=getOS();if(os=='OS X'){if(iOS()){os='iOS';}}}function isTouchDevice(){return(('ontouchstart'in window)||(navigator.maxTouchPoints>0)||(navigator.msMaxTouchPoints>0));}switch(os){case'iOS':body.classList.add('is--ios');break;case'Android':body.classList.add('is--android');break;case'Windows':body.classList.add('is--windows');break;case'Linux':body.classList.add('is--linux');break;case'OS X':body.classList.add('is--mac');break;case'Huawei':body.classList.add('is--android');break;}if(isTouchDevice()){body.classList.add('is--touch');}else{body.classList.add('is--no-touch');}const copyFields=document.querySelectorAll('.copy-field-wrapper');var closingTooltipTimeout=setTimeout(function(){},0);const copyButtonTooltip=document.createElement('div');copyButtonTooltip.classList.add('flex','pointer-events-none','invisible','opacity-0','z-20','rounded-8','bg-gray-common','p-16','text-white','text-size-s','absolute','copy-tooltip');body.append
(copyButtonTooltip);const showCopyTooltip=(button,text)=>{const buttonRect=button.getBoundingClientRect();copyButtonTooltip.style.top=`${buttonRect.top+window.scrollY+buttonRect.height/2}px`;copyButtonTooltip.style.left=`${buttonRect.left}px`;clearTimeout(closingTooltipTimeout);copyButtonTooltip.innerHTML=text;copyButtonTooltip.classList.remove('opacity-0','invisible');copyButtonTooltip.classList.add('is--open');closingTooltipTimeout=setTimeout(()=>{copyButtonTooltip.classList.remove('is--open');copyButtonTooltip.classList.add('opacity-0','invisible');},3000);}
const checkScrollCopyTooltip=()=>{if(!copyButtonTooltip.classList.contains('opacity-0')){copyButtonTooltip.classList.add('opacity-0','invisible');copyButtonTooltip.classList.remove('is--open');}}
window.addEventListener('scroll',()=>{checkScrollCopyTooltip();});Array.prototype.forEach.call(copyFields,(field)=>{const copyButton=field.querySelector('.copy-field-button');const copyText=field.querySelector('.copy-field-text');const clipboard=new ClipboardJS(copyButton,{text:function(trigger){return copyText.textContent;}});copyButton.classList.add('items-center');clipboard.on('success',function(e){showCopyTooltip(copyButton,siteConfig.lexicon.copy_success);e.clearSelection();});clipboard.on('error',function(e){showCopyTooltip(copyButton,siteConfig.lexicon.copy_error);});});class Tabs{constructor(container){this.container=container;this.tabLinks=container.querySelectorAll('.w-tab-link');this.tabPanes=container.querySelectorAll('.w-tab-pane');this.currentTab=container.getAttribute('data-current');this.durationIn=parseInt(container.getAttribute('data-duration-in'))||300;this.durationOut=parseInt(container.getAttribute('data-duration-out'))||100;this.easing=container.getAttribute(
'data-easing')||'ease';this.activeTab=this.currentTab||this.tabLinks[0].getAttribute('data-w-tab');this.isAnimating=false;this.initializeActiveTab(this.activeTab);this.addEventListeners();}initializeActiveTab(targetTab){const targetPane=this.container.querySelector(`.w-tab-pane[data-w-tab="${targetTab}"]`);if(targetPane){targetPane.style.display='block';targetPane.style.opacity=1;targetPane.style.transition=`opacity ${this.durationIn}ms ${this.easing} 0s`;targetPane.classList.add('w--tab-active');}this.tabLinks.forEach(tabLink=>{if(tabLink.getAttribute('data-w-tab')===targetTab){tabLink.classList.add('w--current');}else{tabLink.classList.remove('w--current');}});this.activeTab=targetTab;}addEventListeners(){this.tabLinks.forEach(tabLink=>{tabLink.addEventListener('click',(event)=>{event.preventDefault();const targetTab=tabLink.getAttribute('data-w-tab');if(targetTab===this.activeTab||this.isAnimating){return;}this.updateTabs(targetTab);});});}updateTabs(targetTab){this.isAnimating=true
;const activePane=this.container.querySelector(`.w-tab-pane[data-w-tab="${this.activeTab}"]`);const targetPane=this.container.querySelector(`.w-tab-pane[data-w-tab="${targetTab}"]`);if(activePane){this.fadeOut(activePane,this.durationOut,this.easing,()=>{activePane.style.display='none';activePane.classList.remove('w--tab-active');if(targetPane){targetPane.style.display='block';this.fadeIn(targetPane,this.durationIn,this.easing,()=>{this.isAnimating=false;});targetPane.classList.add('w--tab-active');}this.tabLinks.forEach(tabLink=>{if(tabLink.getAttribute('data-w-tab')===targetTab){tabLink.classList.add('w--current');}else{tabLink.classList.remove('w--current');}});this.activeTab=targetTab;});}}fadeOut(element,duration,easing,callback){element.style.transition=`opacity ${duration}ms ${easing}`;element.style.opacity=0;setTimeout(()=>{if(callback)callback();},duration);}fadeIn(element,duration,easing,callback){element.style.opacity=0;element.style.transition=`opacity ${duration}ms ${
easing}`;requestAnimationFrame(()=>{element.style.opacity=1;if(callback){setTimeout(callback,duration);}});}static initAll(){const tabsContainers=document.querySelectorAll('.w-tabs');tabsContainers.forEach(container=>new Tabs(container));}}document.addEventListener("DOMContentLoaded",()=>{Tabs.initAll();});const slidersContainers=document.querySelectorAll('.swiper-container');const slidersInitializeArray=[];const slidersObesrversArray=[];Array.prototype.forEach.call(slidersContainers,(sliderContainer,index)=>{const slidesPerView=sliderContainer.getAttribute('data-slides-per-view')||"auto";const sliderArrows=sliderContainer.getAttribute('data-arrows')||false;const sliderAutoplay=sliderContainer.getAttribute('data-autoplay')||true;const sliderEffect=sliderContainer.getAttribute('data-effect')||"slide";const sliderSmEffect=sliderContainer.getAttribute('data-sm-effect')||"slide";const slidesPerViewXs=sliderContainer.getAttribute('data-slides-per-view-xs')||"auto";const slidesPerViewSm=
sliderContainer.getAttribute('data-slides-per-view-sm')||"auto";const slidesPerViewMd=sliderContainer.getAttribute('data-slides-per-view-md')||"auto";const slidesPerViewLg=sliderContainer.getAttribute('data-slides-per-view-lg')||"auto";const disableOnDesktop=sliderContainer.getAttribute('disable-desktop')||0;const sliderButtonNext=sliderContainer.querySelector('.slider-button-next');const sliderButtonPrev=sliderContainer.querySelector('.slider-button-prev');const sliderPagination=sliderContainer.querySelector('.swiper-pagination');const sliderOptions={speed:400,spaceBetween:0,effect:sliderEffect,slidesPerView:slidesPerView,spaceBetween:0.8*remSize,pagination:{el:sliderPagination,clickable:true},navigation:{nextEl:sliderButtonNext,prevEl:sliderButtonPrev,disabledClass:'is--disabled'},breakpoints:{0:{slidesPerView:slidesPerViewXs,spaceBetween:0.8*remSize,},640:{slidesPerView:slidesPerViewSm,spaceBetween:0.8*remSize,},768:{slidesPerView:slidesPerViewMd,spaceBetween:1.6*remSize,},991:{
slidesPerView:slidesPerViewLg,spaceBetween:1.6*remSize,}},on:{autoplayTimeLeft(s,time,progress){sliderContainer.style.setProperty("--progress",1-progress);}}}
if(sliderAutoplay==true){sliderOptions.autoplay={delay:4000,disableOnInteraction:false}}slidersInitializeArray.push(null);slidersObesrversArray.push(null);if((disableOnDesktop&&window.innerWidth<768)||!disableOnDesktop){slidersInitializeArray[index]=enableSwiperSlider(slidersInitializeArray[index],sliderContainer,sliderOptions);slidersInitializeArray[index].autoplay.stop();if(slidersObesrversArray[index]==null){slidersObesrversArray[index]=new IntersectionObserver((entries,observer)=>{if(entries[0].isIntersecting){slidersInitializeArray[index].autoplay.start();}else{slidersInitializeArray[index].autoplay.stop();}}).observe(sliderContainer)}}window.addEventListener('resize',()=>{remSize=getComputedStyle(document.documentElement).getPropertyValue('--remSize');if(disableOnDesktop&&window.innerWidth>767){if(slidersInitializeArray[index]!==null)slidersInitializeArray[index]=destroySwiperSlider(slidersInitializeArray[index],sliderContainer);}else if(slidersInitializeArray[index]==null||
slidersInitializeArray[index].destroyed){slidersInitializeArray[index]=enableSwiperSlider(slidersInitializeArray[index],sliderContainer,sliderOptions);}else if(slidersInitializeArray[index].initialized){slidersInitializeArray[index].params.spaceBetween=0.8*remSize;slidersInitializeArray[index].params.breakpoints[640].spaceBetween=0.8*remSize;slidersInitializeArray[index].params.breakpoints[768].spaceBetween=1.6*remSize;slidersInitializeArray[index].params.breakpoints[991].spaceBetween=1.6*remSize;}const scrollDisabledElements=document.querySelectorAll('.ui-selectmenu-open, .tooltip-content.is--open, .navbar__menu-wrapper.is--open');if(window.innerWidth>767&&scrollDisabledElements.length){bodyScrollControls.enable();}else if(window.innerWidth<768&&scrollDisabledElements.length){bodyScrollControls.disable();}})});function destroySwiperSlider(sliderSwiper,sliderElement){sliderSwiper.destroy(true,true);const swiperWrapper=sliderElement.querySelector('.slider-wrapper');const swiperSlides=
sliderElement.querySelectorAll('.slider-slide');const sliderDesctopCol=sliderElement.querySelector('.slider-desktop-column');const itemsInsideInnerCol=swiperWrapper.querySelectorAll('[desktop-inside-column]');swiperWrapper.classList.remove('swiper-wrapper');Array.prototype.forEach.call(swiperSlides,(swiperSlide)=>{swiperSlide.classList.remove('swiper-slide')})
Array.prototype.forEach.call(itemsInsideInnerCol,(swiperSlide)=>{sliderDesctopCol.append(swiperSlide);})
return sliderSwiper;}function enableSwiperSlider(sliderSwiper,sliderElement,sliderOptions){const swiperWrapper=sliderElement.querySelector('.slider-wrapper');const swiperSlides=sliderElement.querySelectorAll('.slider-slide');const sliderDesctopCol=sliderElement.querySelector('.slider-desktop-column');var itemsInsideInnerCol=null;if(sliderDesctopCol){itemsInsideInnerCol=sliderDesctopCol.querySelectorAll('.slider-slide');Array.prototype.forEach.call(itemsInsideInnerCol,(swiperSlide)=>{swiperSlide.setAttribute('desktop-inside-column',true);swiperWrapper.append(swiperSlide);})}swiperWrapper.classList.add('swiper-wrapper');Array.prototype.forEach.call(swiperSlides,(swiperSlide)=>{swiperSlide.classList.add('swiper-slide')})
sliderSwiper=new Swiper(sliderElement,sliderOptions);return sliderSwiper;}class Tooltip{constructor(options){this.tooltip=options.element;this.tooltipWrap=this.tooltip.querySelector('.tooltip');this.opened=0;this.content=options.content;this.buttons=options.buttons?options.buttons:[{type:"confirm",text:siteConfig.lexicon.confirm,href:"#",classList:["hidden","sm--block"]}];this.title=options.title;this.tooltipHeading=options.tooltipHeading;this.isMobile=window.innerWidth<768?true:false;this.init();this.attachEventListeners();this.moveTooltipContentOnMobile();}init(){if(this.tooltipWrap==undefined){this.renderTooltip();}else{this.tooltipContent=this.tooltip.querySelector('.tooltip-content');this.tooltipHandle=this.tooltip.querySelector('.tooltip-handle');this.tooltipOverlay=this.tooltip.querySelector('.tooltip-overlay');this.tooltipClose=this.tooltip.querySelector('.tooltip-close');this.tooltipConfirm=this.tooltip.querySelector('.tooltip-confirm');}this.setPosition();}setPosition(){const
containerRect=this.tooltip.closest('.container').getBoundingClientRect();const tooltipRect=this.tooltipWrap.getBoundingClientRect();if(containerRect.x+containerRect.width<tooltipRect.x+314){this.tooltipContent.classList.add("tooltip-left","pr-6");this.tooltipContent.classList.remove("pl-6");}else{this.tooltipContent.classList.remove("tooltip-left","pr-6");this.tooltipContent.classList.add("pl-6");}}moveTooltipContentOnMobile(){if(this.isMobile){document.body.appendChild(this.tooltipContent);}}attachEventListeners(){if(this.tooltipOverlay)this.tooltipOverlay.addEventListener('click',(e)=>{e.preventDefault();this.close()});if(this.tooltipClose)this.tooltipClose.addEventListener('click',(e)=>{e.preventDefault();this.close()});if(this.tooltipConfirm)this.tooltipConfirm.addEventListener('click',(e)=>{e.preventDefault();this.close()});if(this.tooltipHandle)this.tooltipHandle.addEventListener('click',(e)=>{if(this.isMobile){e.preventDefault();this.open();}});window.addEventListener('resize',(
)=>{if(window.innerWidth<768){this.isMobile=true;document.body.appendChild(this.tooltipContent);}else{this.isMobile=false;this.close();this.tooltipWrap.appendChild(this.tooltipContent);}this.setPosition();});}open(){bodyScrollControls.disable({onlyMobile:true,callback:()=>{this.tooltipContent.classList.add('is--open');this.opened=1;}});}close(){bodyScrollControls.enable({onlyMobile:true,callback:()=>{this.tooltipContent.classList.remove('is--open');this.opened=0;}});}hide(){if(this.opened){this.close();setTimeout(()=>{this.tooltipWrap.classList.add("hidden");},400)}else{this.tooltipWrap.classList.add("hidden");}}show(){this.tooltipWrap.classList.remove("hidden");}updateTooltip(title,content,buttons){this.content=content;this.tooltipTextContent.innerHTML=this.content;if(title){this.title=title;this.tooltipHeader.innerHTML=this.title;}if(buttons){this.buttons=buttons;this.renderTooltipButtons();if(this.tooltipConfirm)this.tooltipConfirm.addEventListener('click',()=>{this.close()});}}
renderTooltip(){this.tooltipWrap=document.createElement("div");this.tooltipWrap.classList.add("tooltip","relative");this.tooltipHandle=document.createElement('i');this.tooltipHandle.classList.add("icon-18","ml-8","tooltip-handle","transition-all-300","text-gray-com","hover--text-black","icon-question");this.tooltipWrap.append(this.tooltipHandle);this.tooltipContent=document.createElement("div");this.tooltipContent.classList.add("tooltip-content","pl-6","z-10");this.tooltipContent.innerHTML='<img src="/assets/images/tooltip-arrow.png" loading="lazy" alt="" class="tooltip-arrow sm--hidden">';this.tooltipOverlay=document.createElement('div');this.tooltipOverlay.classList.add("tooltip-overlay")
this.tooltipContent.append(this.tooltipOverlay);this.tooltipInnerWrap=document.createElement('div');this.tooltipInnerWrap.classList.add('tooltip-inner-wrap');this.tooltipHeader=document.createElement("div");this.tooltipHeader.classList.add("hidden","sm--block","heading-style-h3","mb-20")
this.tooltipHeader.innerHTML=this.title;this.tooltipClose=document.createElement('i');this.tooltipClose.classList.add("absolute","icon-24","right-32","text-black","hover--text-green","active--text-dark-green","transition-all-300","icon-close","top-32","hidden","sm--flex","sm--right-20","sm--top-20","tooltip-close");this.tooltipInnerWrap.append(this.tooltipHeader);this.tooltipInnerWrap.append(this.tooltipClose);this.tooltipTextContentWrap=document.createElement("div");this.tooltipTextContentWrap.classList.add("sm--overflow-y-auto","sm--overflow-x-hidden");const tooltipTextContentInner=document.createElement("div");tooltipTextContentInner.classList.add("p-16","rounded-8","bg-gray-common","text-white","w-314","sm--w-full","sm--bg-transparent","sm--rounded-0","sm--text-black","sm--p-0");this.tooltipTextContentWrap.append(tooltipTextContentInner);this.tooltipTextContent=document.createElement("div");this.tooltipTextContent.classList.add("last-p--mb-0","ul-dots-white","sm--mb-20","mb-4");
this.tooltipTextContent.innerHTML=this.content;tooltipTextContentInner.append(this.tooltipTextContent)
this.tooltipTextContentWrap.append(tooltipTextContentInner);new SimpleBar(this.tooltipTextContentWrap,{autoHide:false,});this.tooltipButtonsWrap=document.createElement("div");this.tooltipButtonsWrap.classList.add("flex","mx-8","space-x-reverse","space-y-reverse","flex-wrap","sm--mx-4","sm--my-4");this.renderTooltipButtons();this.tooltipInnerWrap.append(this.tooltipTextContentWrap);this.tooltipInnerWrap.append(this.tooltipButtonsWrap);this.tooltipContent.append(this.tooltipInnerWrap);this.tooltipWrap.append(this.tooltipContent);this.tooltip.append(this.tooltipWrap);}renderTooltipButtons(){this.tooltipButtonsWrap.innerHTML='';Array.prototype.forEach.call(this.buttons,(button)=>{const tooltipButtonWrap=document.createElement("div");tooltipButtonWrap.classList.add("p-8","sm--p-4","sm--w-full","xs--w-full","hidden","sm--block");const buttonElement=document.createElement("a");buttonElement.classList.add("text-link","sm--button","sm--w-full","tooltip-confirm");if(button.classList.length>0){
button.classList.forEach((className)=>{buttonElement.classList.add(className);})}buttonElement.textContent=button.text;buttonElement.setAttribute("href",button.href);tooltipButtonWrap.append(buttonElement);this.tooltipButtonsWrap.append(tooltipButtonWrap);if(button.type=="confirm"){this.tooltipConfirm=buttonElement;}});}}const tooltips=document.querySelectorAll('.tooltip');const tooltipsArray=[]
Array.prototype.forEach.call(tooltips,(tooltip)=>{tooltipsArray.push(new Tooltip({element:tooltip.parentNode}));})
const transitionEndEventName=getTransitionEndEventName();function Dropdowns(options){this.selector=options.selector;this.dropdownsDOM=document.querySelectorAll(options.selector);this.openFirst=options.openFirst;this.openAll=options.openAll;this.scrollToOpen=options.scrollToOpen;this.onlyOneOpened=options.onlyOneOpened;this.onlyForMobile=options.onlyForMobile;this.onlyForDesktop=options.onlyForDesktop;this.dropdowns=[];this.prepareDropdowns();this.attachEventHandlers();}Dropdowns.prototype.reInit=function(){this.dropdowns=[];this.dropdownsDOM=document.querySelectorAll(this.selector);this.prepareDropdowns();this.attachEventHandlers();}
Dropdowns.prototype.attachEventHandlers=function(){const self=this;window.addEventListener('resize',()=>{this.dropdowns.forEach((dropdown)=>{if(dropdown.opened){dropdown.openDropdown();}})
if((self.onlyForMobile&&window.innerWidth>767)||(self.onlyForDesktop&&window.innerWidth<768)){this.dropdowns.forEach((dropdown)=>{dropdown.removeStyles();})}if(this.openAll&&((self.onlyForMobile&&window.innerWidth<768)||(self.onlyForDesktop&&window.innerWidth>767))){this.dropdowns.forEach((dropdown)=>{dropdown.openDropdown();})}})
this.dropdowns.forEach((dropdown)=>{dropdown.toggle.addEventListener("click",(event)=>{if(dropdown.opened){dropdown.closeDropdown();}else{dropdown.openDropdown();}if(self.onlyOneOpened){this.dropdowns.forEach((siblingDropdown)=>{if(dropdown!=siblingDropdown&&siblingDropdown.opened)siblingDropdown.closeDropdown();})}if(self.scrollToOpen&&dropdown.opened){setTimeout(function(){dropdown.scrollToOpenDropdown();},550)}});dropdown.dropdownList.addEventListener("transitionend",()=>{});})}
Dropdowns.prototype.prepareDropdowns=function(){const self=this;this.dropdownsDOM.forEach((dropdown,index)=>{if(this.openFirst&&index==0||this.openAll){this.dropdowns.push(new Dropdown({element:dropdown,opened:true,onlyForMobile:self.onlyForMobile,onlyForDesktop:self.onlyForDesktop}));}else{this.dropdowns.push(new Dropdown({element:dropdown,opened:false,onlyForMobile:self.onlyForMobile,onlyForDesktop:self.onlyForDesktop}));}})}
function Dropdown(options){this.dropdown=options.element;this.opened=options.opened;this.toggle=this.dropdown.querySelector('.dropdown-toggle');this.dropdownList=this.dropdown.querySelector('.dropdown-content-wrapper');this.dropdownContent=this.dropdown.querySelector('.dropdown-content');this.onlyForMobile=options.onlyForMobile;this.onlyForDesktop=options.onlyForDesktop;this.setInitialPosition();return this;}Dropdown.prototype.setInitialPosition=function(){if(this.opened){this.openDropdown();}else{this.closeDropdown();}}
Dropdown.prototype.scrollToOpenDropdown=function(){const topPos=this.dropdown.getBoundingClientRect().top+window.pageYOffset-20
window.scrollTo({top:topPos,behavior:'smooth'})}
Dropdown.prototype.closeDropdown=function(){if((this.onlyForMobile&&window.innerWidth<768||!this.onlyForMobile)&&(this.onlyForDesktop&&window.innerWidth>767||!this.onlyForDesktop)){this.dropdownList.style.height=0;this.dropdownContent.style.opacity=0;this.dropdownContent.style.transform="";this.opened=0;this.dropdown.classList.remove('is--open');}}
Dropdown.prototype.openDropdown=function(){if((this.onlyForMobile&&window.innerWidth<768||!this.onlyForMobile)&&(this.onlyForDesktop&&window.innerWidth>767||!this.onlyForDesktop)){this.dropdownList.style.height=this.dropdownContent.offsetHeight+'px';this.dropdownContent.style.opacity=1;this.dropdownContent.style.transform="translateY(0)";this.opened=1;this.dropdown.classList.add('is--open');}}
Dropdown.prototype.removeStyles=function(){this.dropdownList.removeAttribute('style');this.dropdownContent.removeAttribute('style');this.opened=0;this.dropdown.classList.remove('is--open');}
function getTransitionEndEventName(){var transitions={"transition":"transitionend","OTransition":"oTransitionEnd","MozTransition":"transitionend","WebkitTransition":"webkitTransitionEnd"}
let bodyStyle=document.body.style;for(let transition in transitions){if(bodyStyle[transition]!=undefined){return transitions[transition];}}}const dropdowns=new Dropdowns({selector:'.faq-dropdown',openFirst:1,scrollToOpen:0,onlyOneOpened:1});const dropdownsVirtualCard=new Dropdowns({selector:'.virtualcard-dropdown',openAll:1});const dropdownsVCalculator=new Dropdowns({selector:'.calculator-dropdown'});const correspondentInnerDropdowns=new Dropdowns({selector:'.correspondents-inner-dropdown',onlyForDesktop:1});const correspondentDropdowns=new Dropdowns({selector:'.correspondents-dropdown',onlyForMobile:1,openFirst:1});const navbarMobileDropdowns=new Dropdowns({selector:'.navbar__link.dropdown-wrapper',onlyForMobile:1});const tableDropdowns=new Dropdowns({selector:'.table-dropdown',onlyForMobile:1});var scrollDistance=0;var scrollBarWidth=window.innerWidth-document.body.clientWidth;window.addEventListener("DOMContentLoaded",()=>{scrollBarWidth=window.innerWidth-document.body.clientWidth;}
)
const bodyScrollControls={disable(params){var options={onlyMobile:false,callback:()=>{}};Object.assign(options,params)
if(options.onlyMobile&&window.innerWidth<768||options.onlyMobile!=true){if(window.scrollY!=0){scrollDistance=window.scrollY;}document.body.style.top=`-${scrollDistance}px`;document.body.style.position='fixed';document.body.style.left=0;document.body.style.right=0;document.body.style.marginRight=`${scrollBarWidth}px`;document.querySelector('.w-nav').style.right=`${scrollBarWidth}px`;document.body.style.paddingRight=null;document.body.style.overflowY='hidden';document.body.classList.add('scroll-disabled');setTimeout(()=>{options.callback();},100)}},enable(params){var options={onlyMobile:false,callback:()=>{}}
Object.assign(options,params)
const scrollDisabled=document.body.classList.contains('scroll-disabled');if((options.onlyMobile&&window.innerWidth<768||options.onlyMobile!=true)&&scrollDisabled){if(parseFloat(window.getComputedStyle(body,null).getPropertyValue('top'))*-1){scrollDistance=parseFloat(window.getComputedStyle(body,null).getPropertyValue('top'))*-1}document.body.removeAttribute('style');window.scrollTo(0,scrollDistance);document.querySelector('.w-nav').style.right=0;document.body.style.overflowY=null;document.body.classList.remove('scroll-disabled');setTimeout(()=>{options.callback();},100)}},};$(document).on('opening','.remodal',function(e){const calcResultBlock=document.querySelector('[data-result-block]');if(calcResultBlock){const calcResultWrap=calcResultBlock.offsetParent;const calcResultBlockTop=calcResultBlock.offsetTop;calcResultBlock.classList.add('relative');calcResultBlock.classList.remove('sticky');calcResultBlock.style.top=`${calcResultBlockTop}px`;}bodyScrollControls.disable();});$(document).
on('closed','.remodal',function(e){bodyScrollControls.enable();});function closeRemodal(){if($('.remodal.remodal-is-opened').length){$('.remodal.remodal-is-opened').find('[data-remodal-action="close"]').trigger('click');}}window.addEventListener("popstate",(event)=>{closeRemodal();});document.onkeydown=function(evt){if(evt.keyCode==27){closeRemodal();}};const menuTrigger=document.querySelector('.navbar__menu-btn');const menuWrapper=document.querySelector('.navbar__menu-wrapper');if(menuTrigger){menuTrigger.addEventListener('click',()=>{if(menuTrigger.classList.contains('is--open')){bodyScrollControls.enable();}else{const activeMenuElement=document.querySelector('.navbar__menu-mobile-wrap .w--current');if(activeMenuElement){activeMenuElement.scrollIntoView({behavior:"smooth",block:"nearest",inline:"nearest"});}bodyScrollControls.disable();}menuWrapper.classList.toggle('is--open');menuTrigger.classList.toggle('is--open');})}class CurrencyConverter{constructor(easyMode){this.rates=null;
this.ratesInApp=1;this.easyMode=easyMode||0;if(this.easyMode==0){this.switchCurrencyApp=document.getElementsByName("inApp");this.reverseButton=document.getElementById("reverse");this.amountField=document.getElementById("amount");this.resultField=document.getElementById("result");this.fromCurrencyField=document.getElementById("fromCurrency");this.toCurrencyField=document.getElementById("toCurrency");this.changeButtons=document.querySelectorAll('[data-converter-button]');this.mapSection=document.querySelector('#branches');this.currencySection=document.querySelector('.converter');this.mapSectionWrapper=null;this.currencyUpdateEvent=new Event("currencyUpdate");this.updateCurrencySymbols();this.fromInputMask=null;this.toInputMask=null;this.fromMaskOptions={mask:[{mask:""},{mask:`num ${this.fromCurrencySymbol}`,lazy:false,allowNegative:false,blocks:{num:{mask:Number,scale:2,min:0,thousandsSeparator:" ",padFractionalZeros:false,normalizeZeros:true,radix:",",mapToRadix:["."]}}}]};this.
toMaskOptions={mask:[{mask:""},{mask:`num ${this.toCurrencySymbol}`,lazy:false,allowNegative:false,blocks:{num:{mask:Number,scale:2,min:0,thousandsSeparator:" ",padFractionalZeros:false,normalizeZeros:true,radix:",",mapToRadix:["."]}}}]};this.setInputMasks();this.previousFromCurrencyValue=this.fromCurrencyField.value;this.previousToCurrencyValue=this.toCurrencyField.value;this.previousFromValue=0;this.previousToValue=0;this.fromRawValue=0;this.toRawValue=0;this.attachEventHandlers();}this.fetchExchangeRates();}attachEventHandlers(){this.reverseButton.addEventListener("click",()=>this.reverseCurrencies("reverse"));this.amountField.addEventListener("input",()=>{this.amountField.value=this.fromInputMask._value.replace(/^0+/,"").trim();this.fromInputMask.updateValue;this.fromRawValue=this.fromInputMask.unmaskedValue;this.updateResult();});this.amountField.addEventListener("focus",()=>{this.previousFromValue=this.fromInputMask.unmaskedValue;});this.resultField.addEventListener("focus",()=>{
this.previousToValue=this.toInputMask.unmaskedValue;});this.fromCurrencyField.addEventListener("focus",()=>this.beforeChange());this.toCurrencyField.addEventListener("focus",()=>this.beforeChange());this.fromCurrencyField.addEventListener("change",()=>this.reverseCurrencies("fromCurrency"));this.toCurrencyField.addEventListener("change",()=>this.reverseCurrencies("toCurrency"));this.resultField.addEventListener("input",()=>{this.resultField.value=this.toInputMask._value.replace(/^0+/,"").trim();this.toInputMask.updateValue;this.toRawValue=this.toInputMask.unmaskedValue;this.handleResultInput();});Array.prototype.forEach.call(this.switchCurrencyApp,(switchButton)=>{switchButton.addEventListener("change",()=>{if(switchButton.checked){this.ratesInApp=+switchButton.value;const inAppButton=Array.from(this.changeButtons).find(element=>element.getAttribute('data-converter-button')==='inApp');const inDepartmentButton=Array.from(this.changeButtons).find(element=>element.getAttribute(
'data-converter-button')==='inDepartment');if(this.ratesInApp){inAppButton.classList.remove('hidden');inDepartmentButton.classList.add('hidden');this.mapSectionWrapper.style.height='0px';}else{inAppButton.classList.add('hidden');inDepartmentButton.classList.remove('hidden');this.mapSectionWrapper.style.height=`${this.mapSectionWrapper.scrollHeight}px`;if(BankMapObj){setTimeout(()=>{BankMapObj.filterSelect.setListPosition();BankMapObj.citySelect.setListPosition()},500)}}this.handleResultInput(true);}this.updateCurrencyTable();});});window.addEventListener('resize',()=>{if(!this.ratesInApp){this.mapSectionWrapper.style.height=`${this.mapSectionWrapper.scrollHeight}px`;}})}convert(amount,fromCurrency,toCurrency,reverse){const rate=this.getExchangeRate(fromCurrency,toCurrency,reverse);return amount*rate;}getExchangeRate(fromCurrency,toCurrency,reverse){if(fromCurrency==="uzs"){if(this.ratesInApp&&this.rates[toCurrency].selling_rate_app){if(reverse){return this.rates[toCurrency].
selling_rate_app;}else{return 1/this.rates[toCurrency].selling_rate_app;}}else{if(reverse){return this.rates[toCurrency].selling_rate;}else{return 1/this.rates[toCurrency].selling_rate;}}}else if(toCurrency==="uzs"){if(this.ratesInApp&&this.rates[fromCurrency].buying_rate_app){if(reverse){return this.rates[fromCurrency].buying_rate_app?1/this.rates[fromCurrency].buying_rate_app:0;}else{return this.rates[fromCurrency].buying_rate_app;}}else{if(reverse){return this.rates[fromCurrency].buying_rate?1/this.rates[fromCurrency].buying_rate:0;}else{return this.rates[fromCurrency].buying_rate;}}}}reverseCurrencies(id){if(this.fromCurrencyField.value==="uzs"&&id=="fromCurrency"){this.toCurrencyField.value=this.previousFromCurrencyValue;}else if(this.toCurrencyField.value==="uzs"&&id=="toCurrency"){this.fromCurrencyField.value=this.previousToCurrencyValue;}else if(this.previousFromCurrencyValue==="uzs"&&id=="fromCurrency"){this.toCurrencyField.value="uzs";}else if(this.previousToCurrencyValue===
"uzs"&&id=="toCurrency"){this.fromCurrencyField.value="uzs";}else if(id=="reverse"){this.fromCurrencyField.value=this.previousToCurrencyValue;this.toCurrencyField.value=this.previousFromCurrencyValue;this.toInputMask.unmaskedValue=this.fromInputMask.unmaskedValue;this.toInputMask.updateValue;this.toRawValue=this.fromRawValue;}document.dispatchEvent(this.currencyUpdateEvent,{});this.updateCurrencySymbols();this.toInputMask.updateOptions({mask:[{mask:""},{mask:`num ${this.toCurrencySymbol}`,lazy:false,allowNegative:false,blocks:{num:{mask:Number,scale:2,min:0,thousandsSeparator:" ",padFractionalZeros:false,normalizeZeros:true,radix:",",mapToRadix:["."]}}}]});this.fromInputMask.updateOptions({mask:[{mask:""},{mask:`num ${this.fromCurrencySymbol}`,lazy:false,allowNegative:false,blocks:{num:{mask:Number,scale:2,min:0,thousandsSeparator:" ",padFractionalZeros:false,normalizeZeros:true,radix:",",mapToRadix:["."]}}}]});this.handleResultInput(true);this.previousFromCurrencyValue=this.
fromCurrencyField.value;this.previousToCurrencyValue=this.toCurrencyField.value;}updateCurrencySymbols(){this.fromCurrencySymbol=this.fromCurrencyField.selectedOptions[0].getAttribute("data-currency-symbol");this.toCurrencySymbol=this.toCurrencyField.selectedOptions[0].getAttribute("data-currency-symbol");}handleResultInput(rawInput){var resultAmount=0;if(rawInput){resultAmount=this.toRawValue;}else{resultAmount=parseFloat(this.toInputMask.unmaskedValue);}const convertedAmount=this.convert(resultAmount,this.fromCurrencyField.value,this.toCurrencyField.value,true);this.fromRawValue=convertedAmount;this.fromInputMask.unmaskedValue=String(convertedAmount);this.fromInputMask.updateValue;}updateResult(rawInput){var amount=0;if(rawInput){amount=this.fromRawValue;}else{amount=parseFloat(this.fromInputMask.unmaskedValue);}const convertedAmount=this.convert(amount,this.fromCurrencyField.value,this.toCurrencyField.value);this.toRawValue=convertedAmount;this.toInputMask.unmaskedValue=String(
convertedAmount);this.toInputMask.updateValue;}setInputMasks(){this.fromInputMask=IMask(this.amountField,this.fromMaskOptions);this.toInputMask=IMask(this.resultField,this.toMaskOptions);}prepareRate(obj){for(var key in obj){if(parseFloat(obj[key].buying_rate)>0)obj[key].buying_rate=parseFloat(obj[key].buying_rate)/100;if(parseFloat(obj[key].selling_rate)>0)obj[key].selling_rate=parseFloat(obj[key].selling_rate)/100;if(parseFloat(obj[key].selling_rate_app)>0)obj[key].selling_rate_app=parseFloat(obj[key].selling_rate_app)/100;if(parseFloat(obj[key].buying_rate_app)>0)obj[key].buying_rate_app=parseFloat(obj[key].buying_rate_app)/100;if(parseFloat(obj[key].sb_course)>0)obj[key].sb_course=parseFloat(obj[key].sb_course)/100;obj[key].difference=parseFloat(obj[key].difference);}return obj;}beforeChange(){this.previousFromCurrencyValue=this.fromCurrencyField.value;this.previousToCurrencyValue=this.toCurrencyField.value;}updateCurrency(id){this.reverseCurrencies(id);}formatDate(inputDate){const
months=siteConfig.lexicon.currency_converter.months.split(',');const date=new Date(inputDate);const day=date.getDate();const monthIndex=date.getMonth();const year=date.getFullYear();const formattedDate=`${day}&nbsp;${months[monthIndex]}&nbsp;${year}`;return formattedDate;}updateSelectFields(){for(var key in this.rates){const optionFrom=this.fromCurrencyField.querySelector(`[value="${key}"]`);const optionTo=this.toCurrencyField.querySelector(`[value="${key}"]`);if(this.ratesInApp&&!this.rates[key].buying_rate_app){optionFrom.setAttribute('disabled','disabled');optionTo.setAttribute('disabled','disabled');}else{optionFrom.removeAttribute('disabled');optionTo.removeAttribute('disabled');}$(this.fromCurrencyField).SelectInput('refresh');$(this.toCurrencyField).SelectInput('refresh');}}updateNavbarCurrency(){let navUSDSell=document.querySelector('.usd_nav_sell'),navUSDBuy=document.querySelector('.usd_nav_buy'),navUSDBlock=document.querySelector('.usd_nav_currency');navUSDSell&&(navUSDSell.
textContent=this.rates['usd'].buying_rate.toLocaleString());navUSDBuy&&(navUSDBuy.textContent=this.rates['usd'].selling_rate.toLocaleString());navUSDBlock&&(navUSDBlock.classList.remove('opacity-0'));}updateHomeWidgetCurrency(){let widgetUSDSell=document.querySelector('.usd_widget_sell'),widgetUSDBuy=document.querySelector('.usd_widget_buy'),widgetUSDBlock=document.querySelector('.usd_widget_currency'),skeletons=widgetUSDBlock?widgetUSDBlock.querySelectorAll('.skeleton'):[];widgetUSDSell&&(widgetUSDSell.textContent=this.rates['usd'].buying_rate.toLocaleString());widgetUSDBuy&&(widgetUSDBuy.textContent=this.rates['usd'].selling_rate.toLocaleString());Array.prototype.forEach.call(skeletons,(skeleton)=>{skeleton.classList.remove('skeleton');})}updateCurrencyTable(){this.updateSelectFields();var tableUpdatedAt=document.querySelector('.currency_updated_at');tableUpdatedAt&&(tableUpdatedAt.innerHTML=this.formatDate(this.rates['usd'].created_at));for(var key in this.rates){var tableBuyEl=
document.querySelector(`.${key}_table_buy`),tableSellEl=document.querySelector(`.${key}_table_sell`),tableRateEl=document.querySelector(`.${key}_table_rate`),tableRateDynEl=document.querySelector(`.${key}_table_rate_dyn`),tableRateLine=document.querySelector(`.${key}_table_line`);if(tableBuyEl){if(this.ratesInApp&&this.rates[key].buying_rate_app){tableBuyEl.textContent=this.rates[key].buying_rate_app.toLocaleString();}else{tableBuyEl.textContent=this.rates[key].buying_rate.toLocaleString();}}if(tableSellEl){if(this.ratesInApp&&this.rates[key].selling_rate_app){tableSellEl.textContent=this.rates[key].selling_rate_app.toLocaleString();}else if(this.ratesInApp){tableRateLine.classList.add('hidden');}else{tableRateLine.classList.remove('hidden');tableSellEl.textContent=this.rates[key].selling_rate.toLocaleString();}}tableRateEl&&(tableRateEl.textContent=parseFloat(this.rates[key].sb_course.toFixed(2)).toLocaleString('ru-RU',{minimumFractionDigits:2,maximumFractionDigits:2}));tableRateEl&&(
tableRateEl.textContent=parseFloat(this.rates[key].sb_course.toFixed(2)).toLocaleString('ru-RU',{minimumFractionDigits:2,maximumFractionDigits:2}));if(tableRateDynEl){if(+this.rates[key].difference>0){tableRateDynEl.querySelector('.rate_dyn_arrow').classList.add('icon-arrow_up');tableRateDynEl.classList.add('bg-green-light','text-green');}else if(+this.rates[key].difference<0){tableRateDynEl.classList.add('bg-red-light','text-red');tableRateDynEl.querySelector('.rate_dyn_arrow').classList.add('icon-arrow_down');}else{tableRateDynEl.classList.add('hidden');}tableRateDynEl.querySelector('.table_rate_dyn_value').textContent=(this.rates[key].difference/100).toFixed(2).toLocaleString();}}}async fetchExchangeRates(){try{const response=await fetch(siteConfig.api.exchangeRates);const data=await response.text();const currencyObject={};JSON.parse(data).data.forEach((item)=>{var{currency_char,destination_code,buying_rate,selling_rate,sb_course,difference,buying_rate_app,created_at,
selling_rate_app}=item;if(destination_code==7){currencyObject[currency_char.toLowerCase()].buying_rate_app=buying_rate;currencyObject[currency_char.toLowerCase()].selling_rate_app=selling_rate;return false;}currencyObject[currency_char.toLowerCase()]={buying_rate,selling_rate,sb_course,difference,created_at};});this.rates=this.prepareRate(currencyObject);this.updateNavbarCurrency();this.updateHomeWidgetCurrency();if(this.easyMode==0){this.previousToValue=this.toInputMask.unmaskedValue;this.previousFromValue=currencyObject[this.previousToCurrencyValue].buying_rate*this.previousToValue;this.toRawValue=this.previousToValue;this.fromRawValue=this.previousFromValue;if(this.mapSection&&this.currencySection){const mainWrapper=document.querySelector('.main-wrapper');this.mapSectionWrapper=document.createElement('div');this.mapSectionWrapper.append(this.mapSection);this.currencySection.insertAdjacentElement("afterend",this.mapSectionWrapper);this.mapSectionWrapper.classList.add('h-0',
'transition-all-300','overflow-hidden');}this.handleResultInput();this.updateCurrencyTable();}}catch(error){console.error("Error fetching exchange rates:",error);}}}const converterEl=document.querySelector('.converter');var converter=null;if(converterEl){converter=new CurrencyConverter();}else{converter=new CurrencyConverter(true);}$.widget("custom.SelectInput",$.ui.selectmenu,{openMobileBottom:true,currencySelect:false,_refreshMenu:function(){var item,options=this.element.find("option");this.menu.empty();this._parseOptions(options);this._renderMenu(this.menu,this.items);this.menuInstance.refresh();this.menuItems=this.menu.find("li").not(".ui-selectmenu-optgroup").find(".ui-menu-item-wrapper");this._rendered=true;if(!options.length){return;}item=this._getSelectedItem();this.menuInstance.focus(null,item);this._setAria(item.data("ui-selectmenu-item"));this._setOption("disabled",this.element.prop("disabled"));},_renderButtonItem:function(item){this.openMobileBottom=true
this.currencySelect=this.element[0].getAttribute('data-currency-select')==='true';var buttonItem=$("<span>",{class:"ui-selectmenu-text"});this._setText(buttonItem,item.label);if(this.currencySelect){$("<span>",{style:item.element.attr("data-style"),class:"currency-icon "+item.element.attr("data-icon-class")}).appendTo(buttonItem);}buttonItem.css("background-color",item.value);return buttonItem;},_renderItem:function(ul,item){var li=$("<li>");var wrapper=$("<div>",{class:'flex rounded-8 ui-menu-item-wrapper'});if(this.currencySelect){wrapper.text(item.element.attr("data-long-description"))}else{wrapper.text(item.label);wrapper.attr('title',item.element.attr("title"));}if(item.value==this.element[0].value){li.addClass("ui-selectmenu-selected");}else{li.removeClass("ui-selectmenu-selected");}if(item.disabled){li.addClass("ui-state-disabled");}if(item.element.attr('data-items-count')){$("<span>",{class:
"h-20 w-20 rounded-10 text-10px flex items-center justify-center ml-8 bg-blue-light text-black sm--h-16 sm--w-16",text:item.element.attr('data-items-count')}).appendTo(wrapper);}if(this.currencySelect||item.element.attr('data-items-count')){$("<span>",{style:item.element.attr("data-style"),class:"currency-icon "+item.element.attr("data-icon-class")}).appendTo(wrapper);}else{}return li.append(wrapper).appendTo(ul);},_renderMenu:function(ul,items){var that=this;if(!that.selectMenuAnimationWrap){that.menuScrollWrapper=$("<div>",{class:"ui-menu-scroll-wrap overflow-auto max-h-468 min-w-370"});that.selectMenuAnimationWrap=$("<div>",{class:"ui-menu-inner-wrap overflow-hidden rounded-8 box-shadow-1 sm--box-shadow-none"});const selectName=that.element[0].getAttribute('data-name')?that.element[0].getAttribute('data-name'):that.element[0].getAttribute('name');this.menuWrap.addClass("is--mobile-bottom z-10 sm--z-30");this.menuWrap.append(
'<div class="hidden sm--block fixed inset-0 bg-black-30 ui-selectmenu-overlay"></div>');const menuOverlay=this.menuWrap.find('.ui-selectmenu-overlay');this.menuWrap.append('<div class="ui-selectmenu-mobile-wrap z-30 sm--p-20 sm--bg-white sm--w-full sm--relative sm--rounded-0 sm--rounded-t-20"></div>');const menuInnerWrapper=this.menuWrap.find('.ui-selectmenu-mobile-wrap');menuInnerWrapper.append(`<div class="hidden sm--block heading-style-h3 mb-20">${selectName}</div>`);menuInnerWrapper.append(that.selectMenuAnimationWrap);that.selectMenuAnimationWrap.append(that.menuScrollWrapper);that.menuScrollWrapper.append(ul);menuInnerWrapper.append('<div class="ui-selectmenu-close absolute z-30x hidden sm--flex icon-24 right-32 text-black hover--text-green active--text-dark-green transition-all-300 icon-close top-32 sm--top-20 sm--right-20"></div>')
const menuCloseBtn=menuInnerWrapper.find('.ui-selectmenu-close');menuCloseBtn.add(menuOverlay).click(()=>{that.close();})
if(this.currencySelect){ul.addClass("is--currency-list rounded-8 sm--rounded-0 sm--shadow-none");}ul.addClass("is--mobile-bottom-list rounded-8 sm--rounded-0 sm--shadow-none");}$.each(items,function(index,item){that._renderItemData(ul,item);});if(typeof(this.simpleBar)=="undefined"){this.simpleBar=new SimpleBar(that.menuScrollWrapper[0],{autoHide:false,});}else{this.simpleBar.recalculate();}},_resizeMenu:function(){this.menu.outerWidth(Math.max(this.button.outerWidth(),this.menu.width("").outerWidth()+1));this.menuScrollWrapper.outerWidth(Math.max(this.button.outerWidth(),this.menu.width("").outerWidth()+1));}});$("select").SelectInput({open:function(e,ui){$("select").not(this).SelectInput("close");$(this).closest(".input-wrapper").addClass("is-select-opened");if(this.getAttribute('data-mobile-bottom')){bodyScrollControls.disable({onlyMobile:true});}if(this.getAttribute('data-currency-select')){converter.beforeChange();}},close:function(event,ui){$(this).closest(".input-wrapper").
removeClass("is-select-opened");if(this.getAttribute('data-mobile-bottom')){bodyScrollControls.enable({onlyMobile:true});}},select:function(event,ui){$(".ui-selectmenu-open .ui-menu-item").removeClass("ui-selectmenu-selected");$(".ui-selectmenu-open .ui-menu-item").eq(ui.item.index).addClass("ui-selectmenu-selected");},change:function(event,ui){$(this).trigger('change');if(this.getAttribute('data-currency-select')){converter.updateCurrency(this.id);}}});document.addEventListener("currencyUpdate",function(event){$(".is--currency-input select").SelectInput("refresh");});const inputClearBtns=document.querySelectorAll('.input-clear');Array.prototype.forEach.call(inputClearBtns,(clearBtn)=>{clearBtn.addEventListener('click',()=>{const inputField=clearBtn.closest('.input-wrapper').querySelector('input');inputField.value="";inputField.dispatchEvent(new Event('input'));})})
const documentsFilterBts=document.querySelectorAll('.documents-filter .control-button');const documentsItems=document.querySelectorAll('.documents-filter .documents-item')
Array.prototype.forEach.call(documentsFilterBts,(documentsFilterBtn,index)=>{if(index==0){documentsFilterBtn.classList.add('w--current');}documentsFilterBtn.addEventListener('click',()=>{const filterValue=documentsFilterBtn.getAttribute('data-filter-year');if(documentsFilterBtn.classList.contains('w--current')){return false}documentsFilterBts.forEach((filterBtn)=>{if(filterBtn!=documentsFilterBtn){filterBtn.classList.remove('w--current');}});documentsFilterBtn.classList.add('w--current');Array.prototype.forEach.call(documentsItems,(documentItem)=>{const documentItemFilterCondition=documentItem.getAttribute('data-filter-year');documentItem.classList.add('is--hidden');setTimeout(()=>{documentItem.classList.add('hidden');if(filterValue=='all'||filterValue==documentItemFilterCondition){documentItem.classList.remove('hidden');setTimeout(()=>{documentItem.classList.remove('is--hidden');},50)}else{documentItem.classList.add('is--hidden');}},300)});})});const tabLinks=document.querySelectorAll
('.w-tab-link');Array.prototype.forEach.call(tabLinks,(tabLink)=>{tabLink.addEventListener('click',()=>{tabLink.scrollIntoView({behavior:"smooth",block:"nearest",inline:"nearest"});})})
class BankMap{constructor(options){this.mapSectionEl=document.querySelector("#mapSection");this.mapEl=document.querySelector("#map");this.citySelectButton=this.mapSectionEl.querySelector(".sity-select");this.filterSelectButton=this.mapSectionEl.querySelector(".filter-select");this.officesListEl=this.mapSectionEl.querySelector(".branches-list");this.mapPopupEl=this.mapSectionEl.querySelector(".map-popup");this.mapPopupCloseEl=this.mapPopupEl.querySelector('.popup-office-close');this.mapWrapper=this.mapSectionEl.querySelector('.map-wrapper');this.mapObject=null;this.bankMapType='offices';this.setBoundsPromise=null;this.mapClusterer=null;this.mapPopupContentEl=this.mapPopupEl.querySelector(".popup-office-content");this.cultureKey=this.mapSectionEl.getAttribute("data-culture-key");this.default_phone=options.default_phone;this.default_email=options.default_email;this.lexicon=options.lexicon;this.officesList=[];this.bankomatesList=[];this.placemarks=[];this.usedData=[];this.searchResultMenu=
null;this.officeCardSimpleBar=null;this.searchField=null;this.bankTypeWrap=this.mapSectionEl.querySelector('[data-type-select]');this.bankTypeFields=this.bankTypeWrap?this.bankTypeWrap.querySelectorAll('input'):null;this.openBranchesListSm=this.mapSectionEl.querySelectorAll('[data-open-branches-list]');this.openBranchInfoSm=this.mapSectionEl.querySelector('[data-open-mobile-office]');this.branchInfoWrap=this.mapSectionEl.querySelector('[data-mobile-hidden-info]');this.autocomplateInnerWrap=null
this.autocomplateWrap=null
this.branchesListWrap=this.mapSectionEl.querySelector('[data-branches-list-wrap]');this.branchesListClose=this.mapSectionEl.querySelector('[data-branches-list-close]');this.citySelect=null;this.citySelectWrap=this.mapSectionEl.querySelector('[data-city-select-wrap]')
this.сity=null;this.allCities=options.allCities;this.currentCityCode=options.allCities[0].code;this.currentDistrictsCodes=[];this.filterSelect=null;this.uServicesPhysical=[];this.uServicesBusiness=[];this.uAtmServicesPhysical=[];this.uAtmServicesBusiness=[];this.fetchOffices();this.fetchBankomates();}attachEventHandlers(){if(this.bankTypeFields){Array.prototype.forEach.call(this.bankTypeFields,(radioInput)=>{radioInput.addEventListener("change",()=>{if(radioInput.checked){this.changeType(radioInput.value);}})});}this.mapPopupCloseEl.addEventListener('click',()=>{this.closeOfficeCard();});this.openBranchInfoSm.addEventListener('click',()=>{const officePopupMaxHeight=this.mapWrapper.offsetHeight-2*remSize;if(this.branchInfoWrap.classList.contains('is--open')){this.branchInfoWrap.classList.remove('is--open');this.branchInfoWrap.removeAttribute('style');if(this.officeCardSimpleBar){this.officeCardSimpleBar.recalculate();}this.mapPopupEl.removeAttribute('style');}else{this.mapPopupEl.style
.height=`${this.mapPopupEl.offsetHeight}px`;this.branchInfoWrap.classList.add('is--open');this.branchInfoWrap.style.height=`${this.branchInfoWrap.scrollHeight}px`;this.mapPopupEl.style.height=`${officePopupMaxHeight}px`;if(this.officeCardSimpleBar){this.officeCardSimpleBar.recalculate();}}})
Array.prototype.forEach.call(this.openBranchesListSm,(btn)=>{btn.addEventListener('click',(e)=>{if(!this.branchesListWrap.classList.contains('is--open')){this.branchesListWrap.classList.add('is--open');bodyScrollControls.disable();}else{this.branchesListWrap.classList.remove('is--open');bodyScrollControls.enable();}e.preventDefault();})});this.branchesListClose.addEventListener('click',(e)=>{this.branchesListWrap.classList.remove('is--open');bodyScrollControls.enable();});window.addEventListener('resize',()=>{this.setAutocompleteMenuPosition();if(window.innerWidth<768){if(this.branchesListWrap.classList.contains('is--open')){bodyScrollControls.disable();}this.filterSelect.simpleBar.contentEl.prepend(this.citySelect.button);}else{this.citySelectWrap.prepend(this.citySelect.button);}});}formatWorkTime(work_time,weekends,work_days,type){if(type=='offices'){const[days,timeRange]=work_time.split(" ");const[start,end]=timeRange.split("-");const[startHour,startMinute]=start.split(":");const[
endHour,endMinute]=end.split(":");const formattedStartTime=`${startHour.padStart(2,"0")}:${startMinute}`;const formattedEndTime=`${endHour.padStart(2,"0")}:${endMinute}`;const formattedDays=days.split("-").map(day=>this.lexicon[this.cultureKey].daysOfWeek[day.trim()]).join("–");const weekdaysString=`${formattedDays.toLowerCase()}: ${formattedStartTime}–${formattedEndTime}`;const formattedWeekends=weekends.split(",").map(day=>this.lexicon[this.cultureKey].daysOfWeek[day.trim()]).join(", ");const weekendsString=`${formattedWeekends.toLowerCase()}: ${this.lexicon[this.cultureKey].weekend}`;return`${weekdaysString}; ${weekendsString}`;}else if(type=='atm'){return`${work_days.charAt(0).toUpperCase()+work_days.slice(1)} ${work_time}`;}}formatLunchTime(lunch_time){const[startTime,endTime]=lunch_time.split("-");const[startHour,startMinute]=startTime.split(":");const[endHour,endMinute]=endTime.split(":");const formattedStartTime=`${startHour.padStart(2,"0")}:${startMinute}`;const
formattedEndTime=`${endHour.padStart(2,"0")}:${endMinute}`;return`${this.lexicon[this.cultureKey].lunсhFrom} ${formattedStartTime} ${this.lexicon[this.cultureKey].lunchTo} ${formattedEndTime}`;}parseServiceString(inputString){const[physicalPart,businessPart]=inputString.split(".");const parseSection=section=>{const index=section.indexOf(":");return index!==-1?section.substring(index+1).split(",").map(item=>item.trim()):section.split(",").map(item=>item.trim());};return{servicePhysical:parseSection(physicalPart),serviceBusiness:businessPart?parseSection(businessPart):[]};}typographString(text){const abbreviations=['ул.','д.','г.'];abbreviations.forEach(abbr=>{const regex=new RegExp(`(?<=\\s|^)${abbr}(?=\\s|$)\\s*`,'g');text=text.replace(regex,`${abbr}&nbsp;`);});return text.trim();}renderOffices(offices){this.officesListEl.innerHTML='';Array.prototype.forEach.call(offices,office=>{var officeListItem=document.createElement("div");officeListItem.setAttribute("data-popup-target-id",
office.code);officeListItem.classList.add("p-16","cursor-pointer","rounded-12","office-list-item","transition-all-300","active--bg-gray-light","hover--bg-gray-light","bg-white");var titleDiv=document.createElement("div");titleDiv.classList.add("font-medium","mb-12");titleDiv.textContent=office.title[this.cultureKey];var addressDiv=document.createElement("div");addressDiv.classList.add("text-size-s","mb-8");addressDiv.innerHTML=this.typographString(office.address[this.cultureKey]);var timeOfWorksDiv=document.createElement("div");timeOfWorksDiv.classList.add("flex","items-center","text-size-s");var timeOfWorksIcon=document.createElement("i");timeOfWorksIcon.classList.add("icon-12","mr-8","icon-time");var timeOfWorksText=document.createElement("div");if(this.bankMapType=='offices'){timeOfWorksText.textContent=this.formatWorkTime(office.work_time[this.cultureKey],office.weekends[this.cultureKey],'','offices');}else{timeOfWorksText.textContent=this.formatWorkTime(office.work_time[this.
cultureKey],'',office.work_days[this.cultureKey],'atm');}officeListItem.appendChild(titleDiv);officeListItem.appendChild(addressDiv);timeOfWorksDiv.appendChild(timeOfWorksIcon);timeOfWorksDiv.appendChild(timeOfWorksText);officeListItem.appendChild(timeOfWorksDiv);this.officesListEl.appendChild(officeListItem);officeListItem.addEventListener("click",()=>{this.openOfficeCard(office);bodyScrollControls.enable();this.branchesListWrap.classList.remove('is--open');officeListItem.scrollIntoView({behavior:"smooth",block:"nearest",inline:"nearest"});});});const simpleBar=new SimpleBar(this.officesListEl,{autoHide:false,});}openOfficeCard(office){const that=this;const openedDropdowns=document.querySelectorAll('.map-dropdown-open');Array.prototype.forEach.call(openedDropdowns,(dropdownList)=>{dropdownList.classList.remove('map-dropdown-open');});if(office.code==this.mapPopupEl.getAttribute("data-popup-id")&&this.mapPopupEl.classList.contains('is--open'))return false;if(this.mapPopupEl.classList.
contains("is--open")){this.closeOfficeCard(office);setTimeout(()=>{this.mapPopupContentEl.scrollTop=0;this.renderOfficeCard(office);this.mapPopupEl.classList.add("is--open");},300);}else{this.mapPopupContentEl.scrollTop=0;this.renderOfficeCard(office);this.mapPopupEl.classList.add("is--open");}const setCenterPromise=this.mapObject.setCenter([office.coords.lat,office.coords.lng],16,{checkZoomRange:true,useMapMargin:true,duration:500}).then(function(){let objects=ymaps.geoQuery(that.placemarks).search(`lat="${office.coords.lat}"`);objects.get(0).properties.set("selectedClass","is--selected");const placeMarkLabel=document.getElementById(`map-placemark-label_${office.code}`);if(placeMarkLabel){placeMarkLabel.classList.add('is--selected');}},function(){console.log(Error)});this.officesListEl.querySelector(`[data-popup-target-id="${office.code}"]`).classList.add("bg-gray-light");this.officesListEl.querySelector(`[data-popup-target-id="${office.code}"]`).classList.remove("bg-white");this.
mapPopupEl.setAttribute("data-popup-id",office.code);}closeOfficeCard(){checkScrollCopyTooltip();const mapPlacemark=document.getElementById(`map-placemark-label_${this.mapPopupEl.getAttribute("data-popup-id")}`);if(mapPlacemark){mapPlacemark.classList.remove('is--selected');}this.mapPopupEl.classList.remove("is--open");Array.prototype.forEach.call(this.officesListEl.querySelectorAll("[data-popup-target-id]"),listItem=>{listItem.classList.remove("bg-gray-light");listItem.classList.add("bg-white");});this.branchInfoWrap.classList.remove('is--open');this.branchInfoWrap.removeAttribute('style');this.mapPopupEl.removeAttribute('style');if(this.officeCardSimpleBar){this.officeCardSimpleBar.recalculate();}}renderOfficeCard(office){const popupOfficeScrollWrap=this.mapPopupEl.querySelector('.office-card-scroll-wrap');if(this.officeCardSimpleBar==null){this.officeCardSimpleBar=new SimpleBar(popupOfficeScrollWrap,{autoHide:false,})
this.officeCardSimpleBar.getScrollElement().addEventListener('scroll',(e)=>{checkScrollCopyTooltip();})}const popupOfficetitle=this.mapPopupEl.querySelector(".popup-office-title");const popupOfficeAddress=this.mapPopupEl.querySelector(".popup-office-address");const popupOfficeTimeWork=this.mapPopupEl.querySelector(".popup-office-time-work");const popupOfficeLunch=this.mapPopupEl.querySelector(".popup-office-lunch");const popupOfficePhone=this.mapPopupEl.querySelector(".popup-office-phone");const popupOfficeEmail=this.mapPopupEl.querySelector(".popup-office-email");const popupOfficeServices=this.mapPopupEl.querySelector(".popup-office-services");const popupBankomatesType=this.mapPopupEl.querySelector('[data-popup-bankomates-type]');const popupBankomatesOut=this.mapPopupEl.querySelector('[data-popup-bankomates-out]');const popupBankomatesIn=this.mapPopupEl.querySelector('[data-popup-bankomates-in]');const popupBankomatesOrienter=this.mapPopupEl.querySelector(
'[data-popup-bankomates-orienter]');if(this.bankMapType=='atm'){popupBankomatesType.classList.remove('hidden');popupBankomatesType.querySelector('.content-value').textContent=office.type;const bankomatesOutValues=popupBankomatesOut.querySelector('.content-value');const bankomatesInValues=popupBankomatesIn.querySelector('.content-value');bankomatesOutValues.innerHTML='';Array.prototype.forEach.call(office.atm_out,(value)=>{const currencyTag=document.createElement('div')
currencyTag.classList.add('px-12','py-8','flex','rounded-16','bg-blue-label','items-center','text-size-s');currencyTag.textContent=value.toUpperCase();bankomatesOutValues.append(currencyTag);});popupBankomatesOut.classList.remove('hidden');bankomatesInValues.innerHTML='';Array.prototype.forEach.call(office.atm_in,(value)=>{const currencyTag=document.createElement('div')
currencyTag.classList.add('px-12','py-8','flex','rounded-16','bg-blue-label','items-center','text-size-s');currencyTag.textContent=value.toUpperCase();bankomatesInValues.append(currencyTag);});popupBankomatesIn.classList.remove('hidden');popupBankomatesOrienter.classList.remove('hidden');popupBankomatesOrienter.querySelector('.content-value').textContent=office.orienter[this.cultureKey];}else{popupBankomatesType.classList.add('hidden');popupBankomatesOut.classList.add('hidden');popupBankomatesIn.classList.add('hidden');popupBankomatesOrienter.classList.add('hidden');}const popupOfficePhoneVal=office.phone_number!==undefined&&office.phone_number!==null&&office.phone_number!==""?office.phone_number:this.default_phone;const popupOfficeEmailVal=office.email!==undefined&&office.email!==null&&office.email!==""?office.email:this.default_email;popupOfficetitle.textContent=office.title[this.cultureKey];popupOfficeAddress.innerHTML=this.typographString(office.address[this.cultureKey]);if(this.
bankMapType=='offices'){popupOfficeTimeWork.textContent=this.formatWorkTime(office.work_time[this.cultureKey],office.weekends[this.cultureKey],'','offices');}else if(this.bankMapType=='atm'){popupOfficeTimeWork.textContent=this.formatWorkTime(office.work_time[this.cultureKey],'',office.work_days[this.cultureKey],'atm');}if(this.bankMapType=='offices'){popupOfficeLunch.textContent=this.formatLunchTime(office.lunch_time);}popupOfficePhone.innerHTML=popupOfficePhoneVal;popupOfficePhone.setAttribute("href",`tel:${popupOfficePhoneVal.replace(/\D/g,"")}`);popupOfficeEmail.textContent=popupOfficeEmailVal;popupOfficeEmail.setAttribute("href",`mailto:${popupOfficeEmailVal}`);popupOfficeServices.innerHTML="";const officeServices={serviceBusiness:office.serviceBusiness,servicePhysical:office.servicePhysical}
Object.keys(officeServices).forEach(key=>{if(officeServices[key].length>0){const serviceCategoryDiv=document.createElement("div");serviceCategoryDiv.classList.add("text-size-s","text-gray","mb-16","last--mb-0");serviceCategoryDiv.innerHTML=this.lexicon[this.cultureKey][key];popupOfficeServices.appendChild(serviceCategoryDiv);Array.prototype.forEach.call(officeServices[key],service=>{const officeServiceDiv=document.createElement("div");officeServiceDiv.classList.add("mb-12","last--mb-0","first-letter--uppercase");officeServiceDiv.textContent=service;popupOfficeServices.appendChild(officeServiceDiv);});}});}initSearch(){var that=this;that.searchField=$(".map-search")
that.searchField.autocomplete({source:function(request,response){that.autocomplateInnerWrap.find('.empty-responce').remove();var term=request.term.toLowerCase();var filteredData=that.usedData.filter(function(item){return item.title[that.cultureKey].toLowerCase().includes(term)||item.address[that.cultureKey].toLowerCase().includes(term);});response(filteredData);if(filteredData.length==0){that.setAutocompleteMenuPosition();that.searchResultMenu.empty();$("<div class='empty-responce p-16 text-disabled'>"+that.lexicon[that.cultureKey].notFound+"</div>)").appendTo(that.autocomplateInnerWrap);that.autocomplateWrap.addClass("ui-autocomplete-open");}},focus:function(event,ui){that.searchField.val(ui.item.title[that.cultureKey].trim());return false;},select:function(event,ui){const officeListItem=document.querySelector(`[data-popup-target-id="${ui.item.code}"]`)
var officeCity=that.allCities.find(city=>city.code===ui.item.city_code);if(!officeCity){for(const city of that.allCities){for(const district of city.districts){if(district.code===ui.item.district_code){officeCity=city;}}}}if(that.city!==officeCity.name){that.citySelect.setDropdownValue(officeCity.name);}if(officeListItem){officeListItem.scrollIntoView({behavior:"smooth",block:"nearest",inline:"nearest"});that.searchField.val(ui.item.title[that.cultureKey].trim());that.openOfficeCard(ui.item);}else{that.choiseOfficeAfterRender(ui.item);}return false;},open:function(event,ui){that.setAutocompleteMenuPosition();$('#ui-wrap-'+$(that.searchResultMenu).attr('id')).addClass("ui-autocomplete-open");},close:function(event,ui){$('#ui-wrap-'+$(that.searchResultMenu).attr('id')).removeClass("ui-autocomplete-open");}}).autocomplete("instance")._renderItem=function(ul,item){return $("<li>").append("<div class='flex flex-col rounded-8 p-16'><div class='font-medium mb-8'>"+item.title[that.cultureKey].
trim()+"</div><div class='text-size-s text-gray'>"+item.address[that.cultureKey].trim()+"</div></div>").appendTo(ul);}
that.searchField.autocomplete('instance')._renderMenu=function(ul,items){var funcThis=this;$.each(items,function(index,item){funcThis._renderItemData(that.searchResultMenu,item);});}
that.searchResultMenu=that.searchField.autocomplete("widget");that.autocomplateWrap=$("<div>",{class:"ui-autocomplete-menu z-10 absolute sm--z-20",id:`ui-wrap-${$(that.searchResultMenu).attr('id')}`});that.autocomplateInnerWrap=$("<div>",{class:"ui-autocomplete-inner-wrap"});that.searchResultMenu.appendTo(that.autocomplateInnerWrap);that.autocomplateInnerWrap.appendTo(that.autocomplateWrap);that.autocomplateWrap.appendTo($("body"));new SimpleBar(that.autocomplateInnerWrap[0],{autoHide:false,});that.setAutocompleteMenuPosition();}choiseOfficeAfterRender(item){var that=this;this.setBoundsPromise.then(()=>{that.openOfficeCard(item);},()=>{console.log('error');});}setAutocompleteMenuPosition(){const menuWrapper=this.searchResultMenu.closest('.ui-autocomplete-menu');const searchFieldRect=this.searchField[0].getBoundingClientRect();const officesListRect=this.officesListEl.getBoundingClientRect();const topPosition=searchFieldRect.bottom+window.scrollY;menuWrapper[0].style.position='absolute';
menuWrapper[0].style.top=topPosition+'px';menuWrapper[0].style.left=searchFieldRect.left+'px';menuWrapper[0].style.width=searchFieldRect.width+'px';menuWrapper[0].style['max-height']=officesListRect.bottom-searchFieldRect.bottom-.4*remSize+'px';}mapInit(){const that=this;that.mapObject=new ymaps.Map(that.mapWrapper,{center:[41.2994958,69.2400734],zoom:10,controls:[]});var geoLocationLayout=ymaps.templateLayoutFactory.createClass("<div class='relative'><div id='geolocation' class='button absolute is--icon is--small is--primary right-32 sm--right-20 sm--bottom-20 sm--top-auto is--shadow mb-8'><i class='icon-navigation'></i></div></div>"),geoLocationControl=new ymaps.control.GeolocationControl({options:{layout:geoLocationLayout,position:{top:0,left:'auto',right:0}}});var ZoomLayout=ymaps.templateLayoutFactory.createClass("<div class='relative'>"+"<div id='zoom-in' class='absolute right-32 button is--icon is--small is--primary is--shadow sm--right-20'><i class='icon-plus'></i></div>"+
"<div id='zoom-out' class='absolute right-32 button is--icon is--small is--primary is--shadow sm--right-20'><i class='icon-minus'></i></div>"+"</div>",{build:function(){ZoomLayout.superclass.build.call(this);this.zoomInCallback=ymaps.util.bind(this.zoomIn,this);this.zoomOutCallback=ymaps.util.bind(this.zoomOut,this);$('#zoom-in').bind('click',this.zoomInCallback);$('#zoom-out').bind('click',this.zoomOutCallback);},clear:function(){$('#zoom-in').unbind('click',this.zoomInCallback);$('#zoom-out').unbind('click',this.zoomOutCallback);ZoomLayout.superclass.clear.call(this);},zoomIn:function(){var map=this.getData().control.getMap();var zoom=map.getZoom();if(zoom>19){document.getElementById("zoom-in").classList.add('is--disabled');}else{document.getElementById("zoom-in").classList.remove('is--disabled');}document.getElementById("zoom-out").classList.remove('is--disabled');map.setZoom(zoom+1,{checkZoomRange:true});},zoomOut:function(){var map=this.getData().control.getMap();var zoom=map.
getZoom();if(zoom<2){document.getElementById("zoom-out").classList.add('is--disabled');}else{document.getElementById("zoom-out").classList.remove('is--disabled');}document.getElementById("zoom-in").classList.remove('is--disabled');map.setZoom(zoom-1,{checkZoomRange:true});}}),zoomControl=new ymaps.control.ZoomControl({options:{layout:ZoomLayout,position:{top:0,left:'auto',right:0}}});var clustererLayout=ymaps.templateLayoutFactory.createClass('<div class="flex bg-white items-center justify-center rounded-24 w-48 h-48 border-2 border-green-com text-green font-medium text-size-m">{{ properties.geoObjects.length }}</div>',);that.mapClusterer=new ymaps.Clusterer({clusterIconLayout:clustererLayout,clusterIconShape:{type:'Circle',coordinates:[0,0],radius:4.8*remSize,}});var mapAreas=[{top:0,left:0,width:`${51.2*remSize}px`,height:'100%'}];mapAreas.forEach(function(area){var accessor=that.mapObject.margin.addArea(area);});that.mapClusterer.events.add(['mouseenter','mouseleave'],function(e){
var target=e.get('target'),type=e.get('type');if(typeof target.getGeoObjects!='undefined'){if(type=='mouseenter'){}else{}}else{if(type=='mouseenter'){}else{}}});const allData=[...that.officesList,...that.bankomatesList];Array.prototype.forEach.call(allData,office=>{var iconShape="/assets/images/map/placemark_shape.png";var placemarkLogo="/assets/images/map/logo.svg"
if(office.item_type=="atm"){placemarkLogo="/assets/images/map/placemark_card.svg";}var multipurpose="";if(office.branch_type=='mbxo'||office.branch_type=='ubxo'){multipurpose="multipurpose";iconShape="/assets/images/map/placemark_shape_dark.png";}var placemarkLayout=ymaps.templateLayoutFactory.createClass(`
                                                                        <div id="map-placemark_${office.code}" class="map-placemark ${multipurpose} relative">
                                                                            <div id="map-placemark_${office.code}" class="map-placemark-wrap w-48 h-68 pt-20">
                                                                                <div id="map-placemark-label_${office.code}" class="map-placemark-label {{ properties.selectedClass }} relative flex shrink-0 items-center justify-center rounded-24 w-48 h-48 transition-all-300">
                                                                                    <img src="${
placemarkLogo}" class="icon-24">
                                                                                </div>
                                                                                <img class="w-48 absolute bottom-8 -z-10 transition-all-300" src="${iconShape}">
                                                                                <div id="map-placemark-point" class="map-placemark-point flex shrink-0 items-center justify-center w-12 h-12 rounded-6 absolute bottom-0 transition-all-300"></div>
                                                                            </div>
                                                                        </div>`);var placemark=new ymaps.Placemark([office.coords.lat,office.coords.lng],{hintContent:'',officeCode:office.code.toString(),selectedClass:'',},{iconLayout:placemarkLayout,iconShape:{type:'Rectangle',coordinates:[[-2.4*remSize,-6.8*remSize],[2.4*remSize,0]]}})
placemark.events.add('mouseenter',function(e){document.getElementById(`map-placemark-label_${office.code}`).classList.add('is--hover');}).add('mouseleave',function(e){document.getElementById(`map-placemark-label_${office.code}`).classList.remove('is--hover');}).add('click',function(e){that.mapObject.setCenter([office.coords.lat,office.coords.lng],16,{checkZoomRange:true,useMapMargin:true,duration:500});const officeListItem=document.querySelector(`[data-popup-target-id="${office.code}"]`)
officeListItem.scrollIntoView({behavior:"smooth",block:"nearest",inline:"nearest"})
that.openOfficeCard(office);document.getElementById(`map-placemark-label_${office.code}`).classList.add('is--selected')}).add('selected',function(e){document.getElementById(`map-placemark-label_${office.code}`).classList.add('is--selected')});that.placemarks.push(placemark);});that.mapClusterer.add(that.placemarks);that.mapObject.geoObjects.add(that.mapClusterer);that.mapObject.controls.add(geoLocationControl);that.mapObject.controls.add(zoomControl);that.mapObject.behaviors.disable('scrollZoom');that.mapObject.setBounds(that.mapClusterer.getBounds(),{checkZoomRange:true});that.mapObject.events.add(['boundschange','datachange','objecttypeschange'],function(){let objects=ymaps.geoQuery(that.placemarks).searchIntersect(that.mapObject);});that.initSearch();that.initCitySelect();that.initFilterSelect();}initCitySelect(){this.citySelect=new MapDropdown({button:this.citySelectButton,type:"searchList",source:this.allCities.map(item=>item.name),desktopListPosition:"bottom=+12 right",lexicon:
this.lexicon[this.cultureKey].citySelect,onChange:(request)=>{this.changeCity(request.city);}});}changeCity(cityName){const city=this.allCities.find(city=>city.name===cityName);const ditricts=city.districts.map(item=>item.code);const request={city_code:city.code,district_code:ditricts,region_code:city.region_code}
this.city=cityName;this.currentCityCode=city.code;this.currentDistrictsCodes=ditricts;this.currentRegionCode=city.region_code;this.filterObjects(request);this.usedData=this.filterObjectsByCity(city.code,ditricts);}filterObjectsByCity(cityCode,districtCodes){const hasCityCodeOrDistrictCode=obj=>{return obj.city_code===cityCode||districtCodes.includes(obj.district_code);};const sortByCityCode=(a,b)=>{if(a.city_code&&b.city_code){if(a.city_code===cityCode&&b.city_code===cityCode){return 0;}else if(a.city_code===cityCode){return-1;}else if(b.city_code===cityCode){return 1;}else{return a.city_code.localeCompare(b.city_code);}}else if(a.city_code){return-1;}else if(b.city_code){return 1;}else{return 0;}};const filteredObjects=this.usedData.sort(sortByCityCode);return filteredObjects;}initFilterSelect(){this.filterSelect=new MapDropdown({button:this.filterSelectButton,type:"filterList",source:[{filterProp:"branch_type",filterLabel:this.lexicon[this.cultureKey].filters.officeType,filters:[[[
"ubxo","obxo"],this.lexicon[this.cultureKey].filters.ubxo],[["bxo"],this.lexicon[this.cultureKey].filters.bxo]]},{filterProp:"servicePhysical",filterLabel:this.lexicon[this.cultureKey].servicePhysical,filters:this.uServicesPhysical.map(item=>[[item],item])},{filterProp:"serviceBusiness",filterLabel:this.lexicon[this.cultureKey].serviceBusiness,filters:this.uServicesBusiness.map(item=>[[item],item])}],desktopListPosition:"bottom=+4 right",lexicon:this.lexicon[this.cultureKey].filterSelect,onChange:(request)=>{this.filterObjects(request);}});if(window.innerWidth<768){this.filterSelect.simpleBar.contentEl.prepend(this.citySelect.button);}else{this.citySelectWrap.prepend(this.citySelect.button);}}filterObjects(filters){if(!filters.city_code){filters.city_code=this.currentCityCode;filters.region_code=this.currentRegionCode;filters.district_code=this.currentDistrictsCodes;}if(this.bankMapType=='atm'){filters.item_type=['atm'];}else if(this.bankMapType=='offices'){filters.item_type=['branch']
;}var result=this.usedData.filter(branch=>{const cityMatch=branch.city_code&&filters.city_code.includes(branch.city_code.toString());const districtMatch=branch.district_code&&filters.district_code.includes(branch.district_code.toString());const regionMatch=branch.region_code&&filters.region_code.includes(branch.region_code.toString());var cityOrDistrictMatch=cityMatch||districtMatch;if(this.bankMapType=='atm'){cityOrDistrictMatch=cityMatch||regionMatch;}else{}if(cityOrDistrictMatch){return Object.entries(filters).every(([filter,values])=>{if(filter==='city_code'||filter==='district_code'||filter==='region_code'){return true;}if(Array.isArray(branch[filter])){return values.every(value=>branch[filter].map(item=>item.toLowerCase().trim()).includes(value.toLowerCase().trim()));}else{return values.includes(branch[filter].toString().toLowerCase().trim());}});}else{return false;}});if(this.filterSelect)this.filterSelect.updateFilters(filters,result);this.renderOffices(result);this.
togglePlacemarks(result)}togglePlacemarks(data){this.closeOfficeCard();function generateRegexFromArray(objectsArray){const codes=objectsArray.map(obj=>obj.code.toString()).join('|');return`^(${codes})$`;}this.mapObject.geoObjects.removeAll();this.mapClusterer.removeAll();var result=ymaps.geoQuery(this.placemarks);var placemarks=result.search(`properties.officeCode rlike "${generateRegexFromArray(data)}"`).getIterator(),obj;while((obj=placemarks.getNext())!=placemarks.STOP_ITERATION){this.mapClusterer.add(obj);}this.mapObject.geoObjects.add(this.mapClusterer);if(data.length<2){this.setBoundsPromise=this.mapObject.setCenter([data[0].coords.lat,data[0].coords.lng],16);}else{this.setBoundsPromise=this.mapObject.setBounds(this.mapClusterer.getBounds(),{checkZoomRange:true});}}changeType(type){this.closeOfficeCard();this.bankMapType=type;switch(type){case'offices':this.usedData=this.officesList;const officesFilters=[{filterProp:"branch_type",filterLabel:this.lexicon[this.cultureKey].filters.
officeType,filters:[[["ubxo","obxo"],this.lexicon[this.cultureKey].filters.ubxo],[["bxo"],this.lexicon[this.cultureKey].filters.bxo]]},{filterProp:"servicePhysical",filterLabel:this.lexicon[this.cultureKey].servicePhysical,filters:this.uServicesPhysical.map(item=>[[item],item])},{filterProp:"serviceBusiness",filterLabel:this.lexicon[this.cultureKey].serviceBusiness,filters:this.uServicesBusiness.map(item=>[[item],item])}];this.filterSelect.updateSource(officesFilters)
break;case'atm':this.usedData=this.bankomatesList;const atmFilters=[{filterProp:"type",filterLabel:this.lexicon[this.cultureKey].filters.atmType,filters:[[["uzcard"],"UzCard"],[["humo"],"Humo"]]},{filterProp:"state",filterLabel:this.lexicon[this.cultureKey].filters.timeOfWork,filters:[[["enable"],this.lexicon[this.cultureKey].filters.open]]},{filterProp:"atm_in",filterLabel:this.lexicon[this.cultureKey].filters.atm_in,filters:[[["uzs"],"UZS"]]},{filterProp:"atm_out",filterLabel:this.lexicon[this.cultureKey].filters.atm_out,filters:[[["uzs"],"UZS"]]},{filterProp:"servicePhysical",filterLabel:this.lexicon[this.cultureKey].filters.services,filters:this.uAtmServicesPhysical.map(item=>[[item],item])}]
this.filterSelect.updateSource(atmFilters)
break;}this.filterObjects({item_type:this.bankMapType});}parseJSONDataAndStart(jsonData,type){const that=this;const uniqueValues={};const data=JSON.parse(jsonData).data.filter(obj=>{const key=JSON.stringify(obj.coords);const isUnique=!uniqueValues[key];if(isUnique){uniqueValues[key]=true;}return isUnique;});if(type=='offices'){data.sort((a,b)=>parseFloat(a.district_code)>parseFloat(b.district_code)?1:-1);data.forEach(item=>{item={...item,...this.parseServiceString(item.services[this.cultureKey])};item.item_type="branch",this.officesList.push(item);});this.usedData=this.officesList
this.uServicesPhysical=this.officesList.reduce((accumulator,currentObject)=>{currentObject.servicePhysical.forEach(service=>{if(!accumulator.includes(service.toLowerCase())){accumulator.push(service.toLowerCase());}});return accumulator;},[]).sort(function(a,b){return a.length-b.length;});this.uServicesBusiness=this.officesList.reduce((accumulator,currentObject)=>{currentObject.serviceBusiness.forEach(service=>{if(!accumulator.includes(service.toLowerCase())){accumulator.push(service.toLowerCase());}});return accumulator;},[]).sort(function(a,b){return a.length-b.length;});this.renderOffices(this.usedData);ymaps.ready(function(){that.mapInit();});this.attachEventHandlers();}else if(type=='atm'){data.sort((a,b)=>parseFloat(a.region_code)>parseFloat(b.region_code)?1:-1);data.forEach(item=>{const extendData={item_type:"atm",title:item.title?item.title:{ru:siteConfig.lexicon.map_bankomat,uz:siteConfig.lexicon.map_bankomat},code:item.id,atm_in:["uzs"],atm_out:["uzs"],is_open:item.state==
"enable"?true:false,services:item.services?item.services:{uz:"Naqd pul o'tkazish va yechib olish, kreditni to'lash, naqd pul va karta to'lovlari",ru:"Внесение и выдача наличных, Погашение кредитов, Платежи наличными и картой"},city_code:this.allCities.find(obj=>obj.region_code===item.region_code).code}
item={...item,...extendData,...this.parseServiceString(item.atm_type[this.cultureKey])};this.bankomatesList.push(item);this.uAtmServicesPhysical=this.bankomatesList.reduce((accumulator,currentObject)=>{currentObject.servicePhysical.forEach(service=>{if(!accumulator.includes(service.toLowerCase())){accumulator.push(service.toLowerCase());}});return accumulator;},[]).sort(function(a,b){return a.length-b.length;});this.uAtmServicesBusiness=this.bankomatesList.reduce((accumulator,currentObject)=>{currentObject.serviceBusiness.forEach(service=>{if(!accumulator.includes(service.toLowerCase())){accumulator.push(service.toLowerCase());}});return accumulator;},[]).sort(function(a,b){return a.length-b.length;});});}}async fetchOffices(){const cacheKey="officesData";const cacheTimestampKey="cacheTimestamp";const cachedData=localStorage.getItem(cacheKey);const cacheTimestamp=localStorage.getItem(cacheTimestampKey);if(cachedData&&cacheTimestamp){const currentTime=new Date().getTime();const
oneDayInMillis=24*60*60*1000;if(currentTime-parseInt(cacheTimestamp)<oneDayInMillis){this.parseJSONDataAndStart(cachedData,'offices');return false;}}try{const response=await fetch(siteConfig.api.getBranches);const jsonData=await response.json();localStorage.setItem(cacheKey,JSON.stringify(jsonData));localStorage.setItem(cacheTimestampKey,new Date().getTime().toString());this.parseJSONDataAndStart(JSON.stringify(jsonData),'offices');return false;}catch(error){console.error("Ошибка при загрузке или сохранении данных:",error);}}async fetchBankomates(){const cacheKey="bankomatesData";const cacheTimestampKey="cacheTimestamp";const cachedData=localStorage.getItem(cacheKey);const cacheTimestamp=localStorage.getItem(cacheTimestampKey);if(cachedData&&cacheTimestamp){const currentTime=new Date().getTime();const oneDayInMillis=24*60*60*1000;if(currentTime-parseInt(cacheTimestamp)<oneDayInMillis){this.parseJSONDataAndStart(cachedData,'atm');return false;}}try{
const response=await fetch(siteConfig.api.getATM);const jsonData=await response.json();localStorage.setItem(cacheKey,JSON.stringify(jsonData));localStorage.setItem(cacheTimestampKey,new Date().getTime().toString());this.parseJSONDataAndStart(JSON.stringify(jsonData),'atm');return false;}catch(error){console.error("Ошибка при загрузке или сохранении данных:",error);}}}class MapDropdown{constructor(options){this.button=options.button;this.type=options.type;this.desktopListPosition=options.desktopListPosition;this.source=options.source;this.lexicon=options.lexicon;this.cultureKey=options.cultureKey;this.changeEvent=null;this.isOpen=false;this.listWrapper=null;this.listContent=null;this.closeListButton=null;this.searchField=null;this.searchList=null;this.dropdownValue=null;this.filterForm=null;this.simpleBar=null;this.onChange=options.onChange?options.onChange:()=>{};this.renderList();this.setDropdownValue(this.source[0]);this.attachEventsHandlers();}
attachEventsHandlers(){window.addEventListener('mousedown',(e)=>{if(!this.isOpen){return;}if(!$(e.target).closest(this.listWrapper).length){this.closeList();}});this.button.addEventListener('click',()=>{if(this.isOpen){this.closeList();}else{this.openList();}});this.closeListButton.addEventListener('click',()=>{this.closeList();});window.addEventListener('resize',()=>{this.setListPosition();if(window.innerWidth>767&&this.isOpen){bodyScrollControls.enable();}});}renderList(){this.listWrapper=document.createElement('div');this.listWrapper.classList.add('absolute','map-dropdown-list','z-10');this.listContent=document.createElement('div');this.listContent.classList.add('map-dropdown-content','grow','flex','flex-col','pr-6');const listInnerWrapper=document.createElement('div');listInnerWrapper.classList.add('map-dropdown-list-inner','pl-32','py-32','pr-26','rounded-20','box-shadow-1','bg-white','max-h-524','w-480','flex','flex-col','sm--w-full','sm--rounded-16','sm--rounded-b-0','sm--pl-20'
,'sm--py-20','sm--pr-14','sm--max-h-space');this.closeListButton=document.createElement('div');this.closeListButton.classList.add('icon-24','icon-close','cursor-pointer');const listTitleWrap=document.createElement('div');listTitleWrap.classList.add('flex','justify-between','items-center','mb-32');const desktopListTitle=document.createElement('div');desktopListTitle.classList.add('heading-style-h3','sm--hidden');desktopListTitle.textContent=this.lexicon.desktopListTitle;const mobileListTitle=document.createElement('div');mobileListTitle.classList.add('heading-style-h3','pr-6','hidden','sm--flex');mobileListTitle.textContent=this.lexicon.mobileListTitle;if(this.type=="searchList"){this.listContent.innerHTML=
`
                                                                                    <form class="flex pr-6 mb-16">
                                                                                        <div class="input-wrapper is--search grow">
                                                                                            <div class="input-icon">
                                                                                                <div class="icon-search"></div>
                                                                                            </div>
                                                                                            <input type="text" class="input is--clear is--search w-full w-input" placeholder="${this.lexicon.searchLabel
}" autocomplete="off">
                                                                                            <div class="input-clear">
                                                                                                <div class="icon-close"></div>
                                                                                            </div>
                                                                                        </div>
                                                                                    </form>`;this.listContent.classList.add('overflow-hidden');}else{this.listContent.classList.add('overflow-x-hidden','overflow-y-auto');}listTitleWrap.appendChild(desktopListTitle);listTitleWrap.appendChild(mobileListTitle);listTitleWrap.appendChild(this.closeListButton);listInnerWrapper.appendChild(listTitleWrap);this.listWrapper.appendChild(listInnerWrapper);listInnerWrapper.appendChild(this.listContent);document.body.appendChild(this.listWrapper);
this.setListPosition();this.renderListContent();}renderListContent(){if(this.type=="searchList"){this.searchField=this.listContent.querySelector('.input');this.searchList=document.createElement('div');this.searchList.classList.add('my-2','space-y-reverse','flex','overflow-x-hidden','overflow-y-auto');const searchListWrap=document.createElement('div');this.searchList.setAttribute('data-simplebar','');this.searchList.setAttribute('data-simplebar-auto-hide','false');this.listContent.appendChild(this.searchList);const searchFieldClearTrigger=this.listContent.querySelector('.input-clear');searchFieldClearTrigger.addEventListener('click',()=>{this.searchField.value="";this.searchField.dispatchEvent(new Event('input'));})
this.renderSearchList(this.source);this.initSearch();}else if(this.type=="filterList"){this.listContent.innerHTML='';this.filterForm=document.createElement('form');this.filterForm.id=Math.random().toString(36).substring(2,10);this.filterForm.classList.add('flex','flex-col','mx-0','my-0','overflow-hidden');this.listContent.appendChild(this.filterForm);Array.prototype.forEach.call(this.source,(filter)=>{const filterFieldWrap=document.createElement('div');filterFieldWrap.classList.add('mb-32','last--mb-0');const filterFieldset=document.createElement('fieldset');filterFieldset.classList.add('flex','mx-4','my-6','space-x-reverse','space-y-reverse','flex-wrap','p-0');const filterFieldsetLabel=document.createElement('div');filterFieldsetLabel.classList.add('text-size-s','text-gray','mb-16');filterFieldsetLabel.innerHTML=filter.filterLabel;Array.prototype.forEach.call(filter.filters,(field,idx)=>{const filterCheckboxOuterWrap=document.createElement('div');filterCheckboxOuterWrap.classList.add(
'px-4','py-6');filterCheckboxOuterWrap.innerHTML=`
                                                                                    <label class="w-checkbox p-0 relative m-0">
                                                                                        <div class="px-12 py-8 flex rounded-16 items-center transition-all-300 text-black bg-blue-sec m-0 hover--bg-blue-medium relative">
                                                                                            <div class="text-size-s first-letter--uppercase">${field[1]
}</div>
                                                                                            <div class="filter-close-icon overflow-hidden">
                                                                                                <i class="icon-close icon-12 ml-8"></i>
                                                                                            </div>
                                                                                        </div>
                                                                                    </label>
                                                                                    `;const label=filterCheckboxOuterWrap.querySelector('label');const checkbox=document.createElement('input');checkbox.setAttribute("type","checkbox");checkbox.setAttribute("name",filter.filterProp);checkbox.setAttribute("value",field[0]);checkbox.classList.add("w-checkbox-input","filter-checkbox","m-0");label.prepend(checkbox);checkbox.
addEventListener('change',()=>{this.setDropdownValue();})
if(field[2]!==undefined){checkbox.setAttribute(field[2],field[2]);}filterFieldset.appendChild(filterCheckboxOuterWrap);})
filterFieldWrap.appendChild(filterFieldsetLabel);filterFieldWrap.appendChild(filterFieldset);this.filterForm.appendChild(filterFieldWrap);});this.simpleBar=new SimpleBar(this.listContent,{autoHide:false,});}}updateSource(source){this.source=source;this.renderListContent();}openList(){this.isOpen=true;const openedDropdowns=document.querySelectorAll('.map-dropdown-open');Array.prototype.forEach.call(openedDropdowns,(dropdownList)=>{dropdownList.classList.remove('map-dropdown-open');});this.button.classList.add('map-dropdown-open');this.listWrapper.classList.add('map-dropdown-open');if(this.type=="searchList"){this.renderSearchList(this.source);}if(window.innerWidth<768){bodyScrollControls.disable();}}closeList(){if(this.type=="searchList")this.searchField.value="";this.button.classList.remove('map-dropdown-open');this.listWrapper.classList.remove('map-dropdown-open');this.isOpen=false;if(window.innerWidth<768){bodyScrollControls.enable();}}initSearch(){this.searchField.addEventListener(
'input',()=>{const request=this.searchField.value.toLowerCase();const result=this.source.filter(item=>item.toLowerCase().includes(request));this.renderSearchList(result);})}renderSearchList(source){this.searchList.innerHTML='';if(source.length==0){const emptyBlock=document.createElement('div');emptyBlock.classList.add('p-16','text-disabled')
emptyBlock.textContent=this.lexicon.notFound;this.searchList.appendChild(emptyBlock);}else{Array.prototype.forEach.call(source,(item)=>{const searchListItemWrap=document.createElement('div');searchListItemWrap.classList.add('py-2')
const searchListItem=document.createElement('div');searchListItem.classList.add('px-16','py-12','rounded-8','bg-white','transition-all-300','hover--bg-blue-light','cursor-pointer','current--bg-gray-light');searchListItem.textContent=item;if(this.dropdownValue==item){searchListItem.classList.add('w--current');}searchListItemWrap.appendChild(searchListItem);this.searchList.appendChild(searchListItemWrap);searchListItem.addEventListener('click',()=>{this.setDropdownValue(item);this.closeList();});});}new SimpleBar(this.searchList,{autoHide:false,});}updateFilterListContent(source){Array.prototype.forEach.call(this.source,(filter)=>{Array.prototype.forEach.call(filter.filters,(field,idx)=>{const checkbox=document.querySelector(`[value="${field[0].toString()}"][name="${filter.filterProp}"]`)
switch(field[2]){case'checked':checkbox.checked=true;break;case'disabled':checkbox.disabled=true;break;default:checkbox.disabled=false;checkbox.checked=false;}checkbox.setAttribute(field[2],field[2]);})})}formDataToObject(formData){const result={};formData.forEach((value,key)=>{if(result.hasOwnProperty(key)){if(!Array.isArray(result[key])){result[key]=[result[key]];}result[key].push(value);}else{if(value.includes(',')){result[key]=value.split(',').map((item)=>item.trim());}else{result[key]=[value];}}});return result;}setDropdownValue(value){var request=null;var eventName="";if(this.type=="filterList"){eventName="changeFilter";request=this.formDataToObject(new FormData(this.filterForm));}if(this.type=="searchList"){eventName="changeValue";request={city:value}}this.onChange(request);this.dropdownValue=value;const buttonLabel=this.button.querySelector('.map-dropdown-value')
if(buttonLabel)buttonLabel.textContent=value;}getDropdownValue(){var request=null;if(this.type=="filterList"){request=this.formDataToObject(new FormData(this.filterForm));}if(this.type=="searchList"){request={};request.city=this.dropdownValue}return request;}setListPosition(){const position=this.parsePositionString(this.desktopListPosition);const buttonRect=this.button.getBoundingClientRect();const listWrapperRect=this.listWrapper.getBoundingClientRect();const topPosition=buttonRect.bottom+window.scrollY;this.listWrapper.style.position='absolute';this.listWrapper.style.top=topPosition+(position.bottom/10*getRemSize())+'px';if("right"in position)this.listWrapper.style.left=buttonRect.left+buttonRect.width-listWrapperRect.width+'px';}updateFilters(activeFilters,data){if(Object.keys(activeFilters).length>4){this.button.querySelector('.icon').classList.add('is--selected');}else{this.button.querySelector('.icon').classList.remove('is--selected');}const isBoolean=val=>'boolean'===typeof val;
const processFiltersDisabled=(array,valuesToCheck)=>{return array.map(innerArray=>{var isChecked=false;valuesToCheck=Array.isArray(valuesToCheck)?valuesToCheck:[valuesToCheck];if(valuesToCheck.length>0){isChecked=valuesToCheck.some(value=>{if(!Array.isArray(innerArray))return innerArray==value;else return innerArray[0].includes(value.toString());});}if(!isChecked){return[...innerArray,'disabled']}else{if(innerArray[2]=="checked")return innerArray;else return innerArray.slice(0,2)}});};const processFiltersChecked=(array,valuesToCheck)=>{return array.map(innerArray=>{var isChecked=false;valuesToCheck=Array.isArray(valuesToCheck)?valuesToCheck:[valuesToCheck];if(valuesToCheck.length>0){isChecked=valuesToCheck.some(value=>{if(!Array.isArray(innerArray))return innerArray==value;else return innerArray[0].includes(value.toString());});}return isChecked?[...innerArray,'checked']:innerArray.slice(0,2);});}
const getAvailableFilters=(data,property)=>{return data.reduce((accumulator,currentObject)=>{if(Array.isArray(currentObject[property])){currentObject[property].forEach(service=>{if(!accumulator.includes(service.toLowerCase())){accumulator.push(service.toLowerCase());}});}else if(!accumulator.includes(currentObject[property])){if(isBoolean(currentObject[property])){accumulator.push(currentObject[property]?.toString());}else{console.log('Свойство',property,'Имеет значение',currentObject[property]);accumulator.push(currentObject[property]?.toLowerCase());}}return accumulator;},[]);}
this.source.forEach((filter)=>{filter.filters=processFiltersChecked(filter.filters,activeFilters[filter.filterProp]?activeFilters[filter.filterProp]:[])
filter.filters=processFiltersDisabled(filter.filters,getAvailableFilters(data,filter.filterProp)?getAvailableFilters(data,filter.filterProp):[])});this.updateFilterListContent();}parsePositionString(string){const positions={bottom:0,right:0};const parts=string.split(/\s+/);parts.forEach(part=>{const[key,value]=part.split('=');if(key&&value){positions[key.toLowerCase()]=parseFloat(value)||0;}});return positions;}}class Calculator{constructor(options){this.calculatorWrap=document.querySelector("#calculatorBlock");this.products=options.products;this.productsLabel=options.productsLabel;this.type=options.type;this.initialFeesLabel=options.initialFeesLabel;this.resultTop=this.calculatorWrap.querySelector("[data-result-top]");this.resultBottom=this.calculatorWrap.querySelector("[data-result-bottom]");this.differentiatedTitleNotice=this.calculatorWrap.querySelector("[data-differentiated]");this.currentProduct=this.products[0];this.timeDimension=this.currentProduct.timeDimension;this.
timeDimensionMonth=options.timeDimensionMonth;this.timeDimensionYear=options.timeDimensionYear;this.timeDimensionLabelArray=this.timeDimension=='month'?this.timeDimensionMonth:this.timeDimensionYear;this.amountDimension=options.amountDimension;this.currentProductVariant=this.currentProduct.variations[0];this.dimension=this.currentProductVariant.currency;this.allCities=options.allCities;this.citySelect=this.calculatorWrap.querySelector("[data-city-select]");this.citySelectWrap=this.calculatorWrap.querySelector("[data-city-select-wrap]");this.citySelectLabelEl=this.calculatorWrap.querySelector("[data-city-select-label]");this.citySelectLabel=options.citySelectLabel;this.variantSelectWrap=this.calculatorWrap.querySelector("[data-variant-select-wrap]");this.productSelect=this.calculatorWrap.querySelector("[data-product-select]");this.productSelectWrap=this.calculatorWrap.querySelector("[data-product-select-wrap]");this.variantSelect=this.calculatorWrap.querySelector("[data-variant-select]"
);this.variantSelectLabel=this.calculatorWrap.querySelector("[data-variant-select-label]");this.percentField=this.calculatorWrap.querySelector("[data-percent-field]");this.percentLabelNode=this.calculatorWrap.querySelector("[data-percent-label]")
this.productsSelectLabel=this.calculatorWrap.querySelector("[data-products-label]");this.calcCreditTypeWrap=this.calculatorWrap.querySelector("[data-calc-type]");this.calcCreditTypeLabel=this.calculatorWrap.querySelector("[data-calc-type-label]");this.calcCreditTypeFields=this.calcCreditTypeWrap.querySelectorAll("input");this.calcCreditType=this.calcCreditTypeWrap.querySelector("input:checked").value;this.calcCreditExpensesWrap=this.calculatorWrap.querySelector("[data-credit-expenses]");this.calcCreditExpensesCount=this.calculatorWrap.querySelector("[data-credit-expenses-count]");this.calcCreditExpensesFieldsWrap=this.calcCreditExpensesWrap.querySelector("[data-credit-expenses-fields]");this.calcCreditExpensesFieldsList=options.creditExpenses?options.creditExpenses:[];this.calcCreditExpensesFields={};this.calcDocWrap=document.querySelector('[data-documents-wrap]');this.calcDocLabel=document.querySelector('[data-documents-label]');this.calcTable=document.querySelector(
'[data-calculator-table-wrap]');this.calcTableProductName=this.calcTable.querySelector("[data-table-product-name]");this.calcTableProductPercent=this.calcTable.querySelector("[data-table-product-percent]");this.calcTableProductTime=this.calcTable.querySelector("[data-table-product-time]");this.calcTableProductAmount=this.calcTable.querySelector("[data-table-product-amount]");this.calcTableProductFullAmount=this.calcTable.querySelector("[data-table-product-full-amount]");this.calcTableInnerWrap=this.calcTable.querySelector("[data-credit-table]");this.percentLabel=options.percentLabel;this.disclamerLabel=this.calculatorWrap.querySelector("[data-disclaimer-label]");this.tooltips={};this.amountField=new RangeField({name:'amount',element:document.querySelector("#amountRange"),label:this.currentProduct.amountLabel,isFloatLabel:true,value:0,min:this.currentProductVariant.minAmount,max:this.currentProductVariant.maxAmount,amountDimension:this.amountDimension,dimension:["сум","сум",
"сум"]});this.timeField=new RangeField({name:'time',element:document.querySelector("#timeRange"),label:this.currentProduct.timeLabel,isFloatLabel:false,value:0,min:this.currentProductVariant.minTime,max:this.currentProductVariant.maxTime,step:1,dimension:this.timeDimensionLabelArray});this.initialFeesField=new RangeField({name:'initial',element:document.querySelector("#initialFeesRange"),label:this.initialFeesLabel,isFloatLabel:true,value:0,min:1,max:10,step:1,amountDimension:this.amountDimension,dimension:["сум","сум","сум"]});this.percentRangeField=new RangeField({name:'percent',element:document.querySelector("#percentRange"),label:this.percentLabel,isFloatLabel:false,value:50,min:1,max:100,step:0.5,dimension:["%","%","%"]});this.attachEventsHandlers();this.initCalculator();}attachEventsHandlers(){this.timeField.onChange=()=>{if(this.currentProduct.initialFees)this.updateInitialFeesField();this.calcResult();};this.amountField.onChange=()=>{if(this.currentProduct.
initialFees)this.updateInitialFeesField();this.calcResult();};this.initialFeesField.onChange=()=>{this.initialFeesField.setNotify(`${(this.initialFeesField.getValue()/this.amountField.getValue()*100).toFixed(1)} %`);this.calcResult();}
this.percentRangeField.onChange=()=>{this.calcResult();};this.productSelect.onchange=(e)=>{$(this.productSelect).SelectInput("close");this.setProduct(this.productSelect.value,"selectChange");};this.citySelect.onchange=(e)=>{const value=this.citySelect.value;for(let i=0;i<this.currentProduct.variations.length;i++){if(this.currentProduct.variations[i].cities&&this.currentProduct.variations[i].cities.includes(value)){this.changeProductVariant(i);}else{this.changeProductVariant(0);}}};Array.prototype.forEach.call(this.calcCreditTypeFields,(radioInput)=>{radioInput.addEventListener("change",()=>{if(radioInput.checked){this.calcCreditType=radioInput.value;this.calcResult();}})});$(document).on('closed','.remodal',function(e){const calcResultBlock=document.querySelector('[data-result-block]');calcResultBlock.classList.remove('relative');calcResultBlock.classList.add('sticky');calcResultBlock.style.top=``;})}renderProductSelect(){if(this.products.length>1){this.productSelectWrap.classList.
remove('hidden');this.productsSelectLabel.textContent=this.productsLabel;Array.prototype.forEach.call(this.products,(product,i)=>{const option=document.createElement("option");option.setAttribute("value",product.name);if(i==0){option.setAttribute("selected","selected");}option.value=product.id;option.innerHTML=product.name;this.productSelect.append(option);});$(this.productSelect).SelectInput("refresh");}}renderProductVariantsSelect(){if(this.currentProductVariant.citySelect){this.variantSelectWrap.classList.add('hidden');return false}this.variantSelectLabel.textContent=this.currentProduct.variationsLabel;this.variantSelect.innerHTML="";if(this.currentProduct.variations.length>1){var that=this;Array.prototype.forEach.call(that.currentProduct.variations,(variant,index)=>{const radioID=that.makeID(6);const radioWrap=document.createElement("div");radioWrap.classList.add("w-1-2","px-2");const radioLabel=document.createElement("label");radioLabel.classList.add("text-black","text-center",
"p-0","m-0","w-radio");const radioInput=document.createElement("input");radioInput.setAttribute("type","radio");radioInput.setAttribute("name","product_variant");radioInput.id=radioID;radioInput.setAttribute("value",variant.name);radioInput.classList.add("w-form-formradioinput","hide","radio-style-button","w-radio-input");const radioSpan=document.createElement("span");radioSpan.classList.add("py-10","w-full","rounded-6","min-w-154","xs--min-w-0","sm--text-size-m","w-form-label");radioSpan.setAttribute("for",radioID);radioSpan.textContent=variant.name;radioLabel.append(radioInput);radioLabel.append(radioSpan);radioWrap.append(radioLabel);that.variantSelect.append(radioWrap);if(index==0){radioInput.setAttribute("checked","checked");}radioInput.addEventListener("change",()=>{that.changeProductVariant(index);});});this.variantSelectWrap.classList.remove("hidden");}else{this.variantSelectWrap.classList.add("hidden");}}renderProductDocuments(){this.calcDocWrap.innerHTML='';Array.prototype.
forEach.call(this.currentProduct.documents,(doc)=>{const docWrap=document.createElement("div");const docBlock=document.createElement("div");docWrap.classList.add("p-4");docBlock.classList.add("px-16","py-8","rounded-6","bg-green-medium");docBlock.innerHTML=doc;docWrap.append(docBlock);this.calcDocWrap.append(docWrap);});}renderCreditExpensesFields(){this.calcCreditExpensesFieldsWrap.innerHTML="";var that=this;Array.prototype.forEach.call(this.calcCreditExpensesFieldsList,(field)=>{const fieldWrap=document.createElement("div");fieldWrap.classList.add("w-1-2","py-12","px-8","xs--w-full","sm--p-4");const fieldLabel=document.createElement("div");fieldLabel.classList.add("text-gray-com","mb-16");fieldLabel.innerHTML=field[1];const inputWrap=document.createElement("div");inputWrap.classList.add("input-wrapper");const inputElement=document.createElement("input");inputElement.setAttribute("type","text");inputElement.setAttribute("value","0");inputElement.setAttribute("autocomplete","off");
inputElement.setAttribute("placeholder","");inputElement.id=field[0];inputElement.classList.add("input","w-input","is--range-input");this.calcCreditExpensesFields[field[0]]={input:inputElement,mask:new Cleave(inputElement,{numeral:true,numeralDecimalMark:',',delimiter:' ',prefix:` ${that.dimension}`,tailPrefix:true,rawValueTrimPrefix:true})};const inputClearWrap=document.createElement("div");inputClearWrap.classList.add("input-clear");const inputClear=document.createElement("i");inputClear.classList.add("icon-close");inputClearWrap.append(inputClear);fieldWrap.append(fieldLabel);fieldWrap.append(inputWrap);inputWrap.append(inputElement);inputWrap.append(inputClearWrap);this.calcCreditExpensesFieldsWrap.append(fieldWrap);inputClearWrap.addEventListener('click',(e)=>{inputElement.value=`0 ${this.dimension}`;})
inputElement.addEventListener('input',(e)=>{if(inputElement.value.length-(` ${this.dimension}`).length<e.target.selectionStart){const newСarriagePosition=`${String(inputElement.value.replace(/\D/g,"")).replace(/(\d)(?=(\d\d\d)+([^\d]|$))/g,"$1 ")}`.length;inputElement.setSelectionRange(newСarriagePosition,newСarriagePosition)}if(isNaN(Number.parseInt(String(inputElement.value).replace(/\D/g,"")))){inputElement.value=`0 ${this.dimension}`;inputElement.setSelectionRange(1,1)}this.calcResult();this.calcCreditExpensesCount.textContent=this.getCreditExpensesCount();})});}getCreditExpensesCount(){var creditExpensesCount=0;for(var field in this.calcCreditExpensesFields){const fieldObj=this.calcCreditExpensesFields[field];creditExpensesCount+=Number.parseInt(String(fieldObj.input.value).replace(/\D/g,""))>0?1:0;}return creditExpensesCount;}getCreditExpensesAmount(){var creditExpensesAmount=0;for(var field in this.calcCreditExpensesFields){const fieldObj=this.calcCreditExpensesFields[field];
creditExpensesAmount+=Number.parseInt(String(fieldObj.input.value).replace(/\D/g,""));}return creditExpensesAmount;}setDimensionCreditExpenses(){for(var field in this.calcCreditExpensesFields){var fieldObj=this.calcCreditExpensesFields[field];fieldObj.mask.destroy();fieldObj.mask=new Cleave(fieldObj.input,{numeral:true,numeralDecimalMark:',',delimiter:' ',prefix:` ${this.dimension}`,tailPrefix:true,rawValueTrimPrefix:true});}}formatAmount(num){const dimension=this.amountDimension?this.amountDimension.split(','):['','','','',''];if(num>=1000000000){return(num/1000000000).toFixed(0)+`&nbsp${dimension[3]}.`;}else if(num>=1000000){return(num/1000000).toFixed(0)+`&nbsp${dimension[2]}.`;}else if(num>=1000){return(num/1000).toFixed(0)+`&nbsp${dimension[1]}.`;}else{return num.toString();}}getInitialFeesInterval(){var feesPercent=0,initialFeesInterval={min:0,max:0,value:0,minPercent:0,percent:0,maxPercent:70,};Array.prototype.forEach.call(this.currentProductVariant.initialFees,(fees,index)=>{
const timeValue=this.timeDimension=='month'?this.timeField.getValue():this.timeField.getValue()*12;if(fees[0]<=timeValue&&timeValue<=fees[1]){feesPercent=fees[2];}});initialFeesInterval.min=this.amountField.getValue()*(feesPercent/100);initialFeesInterval.max=this.amountField.getValue()*(initialFeesInterval.maxPercent/100);initialFeesInterval.value=initialFeesInterval.min
initialFeesInterval.percent=feesPercent;return initialFeesInterval;}getPercent(){var percent=0
const timeValue=this.timeDimension=='month'?this.timeField.getValue():this.timeField.getValue()*12;if(this.currentProductVariant.percentRange){percent=this.percentRangeField.getValue();}else{Array.prototype.forEach.call(this.currentProductVariant.percent.time,(timePercent,index)=>{if(timePercent[0]<=timeValue&&timeValue<=timePercent[1]){percent=timePercent[2];}});Array.prototype.forEach.call(this.currentProductVariant.percent.initialFee,(intitialFeePercent,index)=>{const initialFeeAmountPercent=(this.initialFeesField.getValue()/this.amountField.getValue()*100).toFixed(1)
if(intitialFeePercent[0]<=initialFeeAmountPercent&&initialFeeAmountPercent<=intitialFeePercent[1]){percent=intitialFeePercent[2];}else if(initialFeeAmountPercent<intitialFeePercent[0]&&index>0&&percent==0){percent=this.currentProductVariant.percent.initialFee[index-1][2];}});}return parseFloat(percent);}calcResult(){switch(this.type){case"deposits":this.calcDeposit();break;case"credits":this.calcCredit();break;case"microloans":this.calcCredit();break;}}calcCredit(){var day=new Date();day.setHours(0,0,0);var resultTable=[];var initialFees=this.currentProduct.initialFees?this.initialFeesField.getValue():0;var creditSum=this.amountField.getValue()-initialFees;var total=[siteConfig.lexicon.calculator.total,0,0,0,0];const creditExpensesAmount=this.getCreditExpensesAmount();const creditTerm=this.timeDimension=="month"?this.timeField.getValue():this.timeField.getValue()*12;switch(this.calcCreditType){case"differentiated":for(let i=0;i<creditTerm;i++){var data=new Date(day.setHours(day.
getHours()+730.00100002022));resultTable[i]=[];resultTable[i][0]=data;if(i==0){resultTable[i][1]=creditSum}else{resultTable[i][1]=resultTable[i-1][1]-resultTable[i-1][3]}total[1]+=resultTable[i][1]
resultTable[i][2]=resultTable[i][1]*this.getPercent()/100/12;total[2]+=resultTable[i][2]
if(creditSum>0){resultTable[i][3]=creditSum/creditTerm;total[3]+=resultTable[i][3]}resultTable[i][4]=resultTable[i][2]+resultTable[i][3];total[4]+=resultTable[i][4]}break;case"annuity":for(let i=0;i<creditTerm;i++){var data=new Date(day.setHours(day.getHours()+730.00100002022));resultTable[i]=[];resultTable[i][0]=data;if(i==0){resultTable[i][1]=creditSum}else{resultTable[i][1]=resultTable[i-1][1]-resultTable[i-1][3]}total[1]+=resultTable[i][1]
resultTable[i][2]=resultTable[i][1]*this.getPercent()/100/12;total[2]+=resultTable[i][2]
if(creditSum>0){resultTable[i][3]=-this.PMT(this.getPercent()/100/12,creditTerm,creditSum)-resultTable[i][2];total[3]+=resultTable[i][3]}resultTable[i][4]=resultTable[i][2]+resultTable[i][3];total[4]+=resultTable[i][4]}break;}const creditFullAmountPercent=(this.getPercent()+(creditExpensesAmount/(total[1]/creditTerm))/this.timeField.getValue()/12).toFixed(2);const totalCreditAmount=(total[2]/total[3]*100).toFixed(2);resultTable.push(total);this.renderResult(creditSum,resultTable[0][4],this.getPercent(),creditTerm,creditFullAmountPercent,resultTable);}calcDeposit(){const percent=this.getPercent();const monthlyBenefit=(percent*this.amountField.getValue()/12/100).toFixed(0);const totalBenefit=(this.amountField.getValue()*(1+percent/12/100*this.timeField.getValue())).toFixed(0);this.resultTop.textContent=`${String(monthlyBenefit).replace(/(\d)(?=(\d\d\d)+([^\d]|$))/g,"$1 ")} ${this.dimension}`;this.resultBottom.textContent=`${String(totalBenefit).replace(/(\d)(?=(\d\d\d)+([^\d]|$))/g,"$1 "
)} ${this.dimension}`;this.percentField.textContent=`${percent}%`;}calcMicroloan(){}renderResult(resultTop,resultBottom,percent,calcTableProductTime,fullCreditPercent,resultTable){this.calcTableProductAmount.innerHTML=`${String(resultTop.toFixed(0)).replace(/(\d)(?=(\d\d\d)+([^\d]|$))/g,"$1 ")}&nbsp;${this.dimension}`;this.resultTop.innerHTML=`${String(resultTop.toFixed(0)).replace(/(\d)(?=(\d\d\d)+([^\d]|$))/g,"$1 ")}&nbsp;${this.dimension}`;if(this.calcCreditType=="differentiated"){const lastCreditPayment=resultTable[resultTable.length-2];this.differentiatedTitleNotice.classList.remove('hidden');if(siteConfig.lexicon.calculator.price_from)this.resultBottom.innerHTML=`${siteConfig.lexicon.calculator.price_from}&nbsp;${String(lastCreditPayment[4].toFixed(0)).replace(/(\d)(?=(\d\d\d)+([^\d]|$))/g,"$1 ")}&nbsp;${this.dimension}`;else this.resultBottom.innerHTML=`${String(lastCreditPayment[4].toFixed(0)).replace(/(\d)(?=(\d\d\d)+([^\d]|$))/g,"$1 ")}&nbsp;${this.dimension}`;}else{this.
differentiatedTitleNotice.classList.add('hidden');this.resultBottom.innerHTML=`${String(resultBottom.toFixed(0)).replace(/(\d)(?=(\d\d\d)+([^\d]|$))/g,"$1 ")}&nbsp;${this.dimension}`;}this.percentField.textContent=`${percent}%`;this.calcTableProductPercent.textContent=`${percent}%`;this.calcTableProductTime.innerHTML=`${calcTableProductTime}&nbsp;${this.pluralizeDimension(calcTableProductTime,this.timeDimensionMonth)}`;this.calcTableProductFullAmount.textContent=`${fullCreditPercent}%`;this.calcTableInnerWrap.innerHTML="";const tableHeadItems=document.querySelectorAll('[data-credit-table-head] div');Array.prototype.forEach.call(resultTable,(tableMonth,index)=>{const tableLine=document.createElement("div");const tableDate=document.createElement("div");const tableToggle=document.createElement("div");const tableToggleIcon=document.createElement("i");const tableDropdownContent=document.createElement("div");const tableDropdownContentWrap=document.createElement("div");var data=new Date(
tableMonth[0])
tableDate.classList.add("grow","block","py-20","font-medium");tableLine.classList.add("flex","text-black","border-t","dropdown-wrapper","calc-table-dropdown","sm--flex-wrap");tableToggle.classList.add("dropdown-toggle","flex","grow","relative","items-center","sm--w-full");tableToggleIcon.classList.add("dropdown-icon","icon-16","icon-down","absolute","right-0","hidden","sm--flex");tableDropdownContent.classList.add("dropdown-content","flex","sm--w-full","sm--translate-y-20","sm--opacity-0","sm--flex-wrap","sm--pb-8");tableDropdownContentWrap.classList.add("dropdown-content-wrapper","overflow-hidden","sm--w-full","sm--h-0");tableDropdownContentWrap.append(tableDropdownContent);if(resultTable.length-1>index){tableDate.innerHTML=`${getMonthNameByIndex(data.getMonth())},&nbsp;${data.getFullYear()}`;}else{tableDate.textContent=`${tableMonth[0]}`;tableLine.classList.add("font-medium");}tableToggle.append(tableDate);tableToggle.append(tableToggleIcon);const tablePayment=document.createElement(
"div");tablePayment.classList.add("w-220","block","py-20","sm--w-1-2");tablePayment.textContent=`${String(tableMonth[4].toFixed(2)).replace(/(\d)(?=(\d\d\d)+([^\d]|$))/g,"$1 ")}`;tableToggle.append(tablePayment);tableLine.append(tableToggle);tableLine.append(tableDropdownContentWrap);const tablePercent=document.createElement("div");const tablePercentLabel=document.createElement("div");const tablePercentValue=document.createElement("div");tablePercentLabel.textContent=tableHeadItems[2].textContent;tablePercentLabel.classList.add("hidden","text-size-s","text-gray","mb-8","sm--flex");tablePercent.classList.add("w-220","block","py-20","sm--py-8","sm--w-1-2");tablePercentValue.textContent=`${String(tableMonth[2].toFixed(2)).replace(/(\d)(?=(\d\d\d)+([^\d]|$))/g,"$1 ")}`;tablePercent.append(tablePercentLabel);tablePercent.append(tablePercentValue);tableDropdownContent.append(tablePercent);const tableMainAmount=document.createElement("div");const tableMainAmountLabel=document.createElement(
"div");const tableMainAmountValue=document.createElement("div");tableMainAmountLabel.textContent=tableHeadItems[3].textContent;tableMainAmountLabel.classList.add("hidden","text-size-s","text-gray","mb-8","sm--flex");tableMainAmount.classList.add("w-220","block","py-20","sm--py-8","sm--w-1-2");tableMainAmountValue.textContent=`${String(tableMonth[3].toFixed(2)).replace(/(\d)(?=(\d\d\d)+([^\d]|$))/g,"$1 ")}`;tableMainAmount.append(tableMainAmountLabel);tableMainAmount.append(tableMainAmountValue);tableDropdownContent.append(tableMainAmount);const tableCreditAmount=document.createElement("div");const tableCreditAmountLabel=document.createElement("div");const tableCreditAmountValue=document.createElement("div");tableCreditAmountLabel.classList.add("hidden","text-size-s","text-gray","mb-8","sm--flex");tableCreditAmount.classList.add("w-220","block","py-20","sm--py-8","sm--w-1-2");if(resultTable.length-1>index){tableCreditAmountLabel.textContent=tableHeadItems[4].textContent;
tableCreditAmountValue.textContent=`${String(tableMonth[1].toFixed(2)).replace(/(\d)(?=(\d\d\d)+([^\d]|$))/g,"$1 ")}`;}else{tableCreditAmount.classList.add('sm--hidden');}tableCreditAmount.append(tableCreditAmountLabel);tableCreditAmount.append(tableCreditAmountValue);tableDropdownContent.append(tableCreditAmount);this.calcTableInnerWrap.append(tableLine);});const tableResultDropdowns=new Dropdowns({selector:'.calc-table-dropdown',onlyForMobile:1});}renderCitySelect(){if(this.currentProductVariant.citySelect){this.citySelectLabelEl.textContent=this.citySelectLabel;Array.prototype.forEach.call(this.allCities,(city)=>{const option=document.createElement("option");option.setAttribute("value",city.code);if(city.code==197){option.setAttribute("selected","selected");}option.textContent=city.name;this.citySelect.append(option);});$(this.citySelect).SelectInput("refresh");this.citySelectWrap.classList.remove('hidden');}else{this.citySelectWrap.classList.add('hidden');}}renderTooltips(){for(var
tooltip in this.currentProduct.tooltips){var label=null;if(this.currentProduct.tooltips[tooltip]){switch(tooltip){case"amount":label=this.amountField.labelElement;break;case"initialFee":label=this.initialFeesField.labelElement;break;case"percentRange":label=this.percentRangeField.labelElement;break;case"percent":label=this.percentLabelNode;break;case"disclaimer":label=this.disclamerLabel;break;case"variants":label=this.variantSelectLabel;break;case"time":label=this.timeField.labelElement;break;case"calc_type":label=this.calcCreditTypeLabel;break;case"documents":label=this.calcDocLabel;break;}if(this.tooltips[tooltip]==undefined&&this.currentProduct.tooltips[tooltip].content){this.tooltips[tooltip]=new Tooltip({element:label,content:this.currentProduct.tooltips[tooltip].content,title:this.currentProduct.tooltips[tooltip].title});}else if(this.currentProduct.tooltips[tooltip].content){this.tooltips[tooltip].updateTooltip(this.currentProduct.tooltips[tooltip].title,this.currentProduct.
tooltips[tooltip].content)
this.tooltips[tooltip].show();}else if(this.tooltips[tooltip]!==undefined&&this.currentProduct.tooltips[tooltip].content==''){this.tooltips[tooltip].hide();}}}}setProduct(productID,type=null){const productIndex=this.products.findIndex(product=>product.id==productID);if(productIndex!==-1){this.amountField.setDimension(this.products[productIndex].variations[0].currency);this.dimension=this.products[productIndex].variations[0].currency;this.changeProduct(productIndex);this.setDimensionCreditExpenses();}if(type!=='selectChange'){this.productSelect.value=productID;$(this.productSelect).SelectInput("refresh");}}changeProduct(productIndex){this.currentProduct=this.products[productIndex];this.timeDimension=this.currentProduct.timeDimension;this.timeDimensionLabelArray=this.timeDimension=='month'?this.timeDimensionMonth:this.timeDimensionYear;this.calcTableProductName.innerHTML=this.currentProduct.name;if(this.currentProduct.initialFees){this.initialFeesField.show();}else{this.initialFeesField.
hide();}this.changeProductVariant(0);this.renderProductDocuments();this.renderProductVariantsSelect();this.renderTooltips();this.renderCitySelect();}changeProductVariant(variantIndex){this.currentProductVariant=this.currentProduct.variations[variantIndex];this.dimension=this.currentProductVariant.currency;this.updateSliderIntervals(variantIndex);this.setDimensionCreditExpenses();this.amountField.setValue(parseFloat(this.amountField.mid),true);this.timeField.setValue(parseFloat(this.timeField.max),true);if(this.currentProduct.initialFees){this.initialFeesField.setValue(parseFloat(this.initialFeesField.min),true);}if(this.currentProductVariant.percentRange){this.percentRangeField.setValue(parseFloat(this.percentRangeField.min),true);}if(this.currentProductVariant.currencyName!=='uzs'){this.amountField.setStep(100);this.initialFeesField.setStep(100);}else{this.amountField.setStep(10000);this.initialFeesField.setStep(10000);}}updateInitialFeesField(){const currency=this.
currentProductVariant.currency;const feesIntervals=this.getInitialFeesInterval();this.initialFeesField.setDimension(currency);this.initialFeesField.setIntervals(feesIntervals.min,0,feesIntervals.max);this.initialFeesField.setNotify(`${(this.initialFeesField.getValue()/this.amountField.getValue()*100).toFixed(1)} %`);}updateSliderIntervals(variantIndex){const currency=this.currentProduct.variations[variantIndex].currency;const minTime=this.timeDimension=='month'?this.currentProduct.variations[variantIndex].minTime:parseFloat((this.currentProduct.variations[variantIndex].minTime/12).toFixed(0));const maxTime=this.timeDimension=='month'?this.currentProduct.variations[variantIndex].maxTime:parseFloat((this.currentProduct.variations[variantIndex].maxTime/12).toFixed(0));this.amountField.setDimension(currency);this.timeField.setDimension(this.timeDimensionLabelArray);if(this.currentProduct.initialFees){this.updateInitialFeesField(variantIndex);}this.amountField.setIntervals(this.
currentProduct.variations[variantIndex].minAmount,0,this.currentProduct.variations[variantIndex].maxAmount);this.timeField.setIntervals(minTime,0,maxTime);if(this.currentProduct.variations[variantIndex].percentRange){this.percentRangeField.setIntervals(this.currentProduct.variations[variantIndex].percent.percentRange[0],0,this.currentProduct.variations[variantIndex].percent.percentRange[1]);}}initCalculator(){this.renderProductSelect();this.renderProductVariantsSelect();this.renderCitySelect();this.changeProductVariant(0);this.renderProductDocuments();this.renderTooltips()
this.updateSliderIntervals(0);this.calcTableProductName.innerHTML=this.currentProduct.name;if(this.currentProductVariant.percentRange){this.percentRangeField.show();}this.percentField.textContent=`${this.getPercent()}%`;if(this.currentProductVariant.initialFees.length>0){this.updateInitialFeesField();this.initialFeesField.show();}if(this.type=="credits"||this.type=="microloans"){this.renderCreditExpensesFields();this.calcCreditTypeWrap.classList.remove("hidden");this.calcCreditExpensesWrap.classList.remove("hidden");}}PMT(i,n,p){return i*p*Math.pow((1+i),n)/(1-Math.pow((1+i),n));}pluralizeDimension(value,words){if(!Array.isArray(words)){return words;}value=Math.abs(value)%100;var num=value%10;if(value>10&&value<20)return words[2];if(num>1&&num<5)return words[1];if(num==1)return words[0];return words[2];}makeID(length){let result="";const characters="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789";const charactersLength=characters.length;let counter=0;while(counter<
length){result+=characters.charAt(Math.floor(Math.random()*charactersLength));counter+=1;}return result;}}class RangeField{constructor(options){this.element=options.element;this.name=options.name;this.animationTime=300,this.input=options.element.querySelector("[data-range-input]");this.mask={};this.value=options.value?options.value:(options.mid?options.mid:options.max);this.label=options.label;this.slider=options.element.querySelector("[data-range-slider]");this.step=options.step?options.step:10000;this.min=options.min;this.mid=options.mid?options.mid:(options.max-options.min)/2+options.min;this.max=options.max;this.notifyLabel=options.element.querySelector("[data-range-notify]");this.minLabel=options.element.querySelector("[data-range-min]");this.midLabel=options.element.querySelector("[data-range-mid]");this.maxLabel=options.element.querySelector("[data-range-max]");this.isFloatLabel=options.isFloatLabel;this.labelElement=options.element.querySelector("[data-range-label]");this.
dimension=options.dimension;this.amountDimension=options.amountDimension;this.onChange=options.onChange?options.onChange:()=>{};this.initField();this.attachEventHandlers()}attachEventHandlers(){this.input.addEventListener("focus",(e)=>{const currentValue=this.input.value.replace(/\D/g,"").replace(/(\d)(?=(\d\d\d)+([^\d]|$))/g,"$1 ");this.input.value=currentValue
const newСarriagePosition=currentValue.length;this.input.setSelectionRange(newСarriagePosition,newСarriagePosition)});this.input.addEventListener("focusout",(e)=>{var correctValue=this.input.value.replace(/\D/g,"");if(correctValue<this.min){correctValue=this.min;}else if(correctValue>this.max){correctValue=this.max;}this.input.value=`${String(correctValue).replace(/(\d)(?=(\d\d\d)+([^\d]|$))/g,"$1 ")} ${this.pluralizeDimension(parseFloat(correctValue),this.dimension)}`;this.setValue(correctValue);$(this.slider).slider("value",this.value);});this.minLabel.addEventListener('click',()=>{this.setValue(parseFloat(this.min).toFixed(0));this.input.value=`${String(this.value).replace(/(\d)(?=(\d\d\d)+([^\d]|$))/g,"$1 ")} ${this.pluralizeDimension(parseFloat(this.value),this.dimension)}`;$(this.slider).slider("value",this.value);});this.midLabel.addEventListener('click',()=>{this.setValue(parseFloat(this.mid).toFixed(0));console.log(this.value);this.input.value=`${String(this.value).replace(
/(\d)(?=(\d\d\d)+([^\d]|$))/g,"$1 ")} ${this.pluralizeDimension(parseFloat(this.value),this.dimension)}`;$(this.slider).slider("value",this.value);})
this.maxLabel.addEventListener('click',()=>{this.setValue(parseFloat(this.max).toFixed(0));this.input.value=`${String(this.value).replace(/(\d)(?=(\d\d\d)+([^\d]|$))/g,"$1 ")} ${this.pluralizeDimension(parseFloat(this.value),this.dimension)}`;$(this.slider).slider("value",this.value);})}getValue(){return parseFloat(this.value);}show(){this.element.classList.remove('hidden');}hide(){this.element.classList.add('hidden');}pluralizeDimension(value,words){if(!Array.isArray(words)){return words;}value=Math.abs(value)%100;var num=value%10;if(value>10&&value<20)return words[2];if(num>1&&num<5)return words[1];if(num==1)return words[0];return words[2];}setStep(step){this.step=step;$(this.slider).slider("option","step",this.step);}setDimension(dimension){const inputDimension=this.pluralizeDimension(this.value,dimension);this.dimension=dimension;this.mask.destroy();this.mask=new Cleave(this.input,{numeral:true,numeralDecimalMark:',',delimiter:' ',});}setNotify(notify=''){this.notifyLabel.
textContent=notify;}setLabel(label){if(label){this.labelElement.textContent=label;}else{this.labelElement.textContent=this.label;}}setIntervals(min,mid,max){mid=mid?parseFloat(mid):parseFloat(((max-min)/2+min).toFixed(1));if(!this.isFloatLabel){mid=parseInt(mid.toFixed(0));}this.min=min;this.mid=mid;this.max=max;this.minLabel.innerHTML=`${this.formatAmount(min)} ${this.pluralizeDimension(min,this.dimension)}`;this.midLabel.innerHTML=`${this.formatAmount(mid)} ${this.pluralizeDimension(mid,this.dimension)}`;this.maxLabel.innerHTML=`${this.formatAmount(max)} ${this.pluralizeDimension(max,this.dimension)}`;if(this.value>=this.max){this.setValue(this.max)}else if(this.value<=this.min){this.setValue(this.min)}$(this.slider).slider("option","min",min);$(this.slider).slider("option","max",max);this.input.value=`${String(this.value.toFixed(0)).replace(/(\d)(?=(\d\d\d)+([^\d]|$))/g,"$1 ")} ${this.pluralizeDimension(this.value,this.dimension)}`;$(this.slider).slider("value",this.value);}
updateField(){this.input.value=`${String(this.value.toFixed(0)).replace(/(\d)(?=(\d\d\d)+([^\d]|$))/g,"$1 ")} ${this.pluralizeDimension(this.value,this.dimension)}`;$(this.slider).slider("value",this.value);}setValue(value,updateField=false){var floatValue=parseFloat(value);if(floatValue>=this.max){this.value=this.max}else if(value<=this.min){this.value=this.min}else{this.value=floatValue;}if(updateField){this.updateField();}this.onChange();}initField(){var that=this;$(that.slider).slider({range:"min",value:that.mid,step:that.step,min:that.min,max:that.max,animate:300,change:function(event,ui){},slide:function(event,ui){that.setValue(ui.value);that.input.value=`${String(ui.value).replace(/(\d)(?=(\d\d\d)+([^\d]|$))/g,"$1 ")} ${that.pluralizeDimension(ui.value,that.dimension)}`;}});that.mask=new Cleave(that.input,{numeral:true,numeralDecimalMark:',',delimiter:' ',});that.setIntervals(that.min,that.mid,that.max);that.setLabel();}formatAmount(num){const dimension=this.amountDimension?this
.amountDimension.split(','):['','','','',''];if(num>=1000000000){return(num/1000000000).toFixed(0)+`&nbsp${dimension[3]}.`;}else if(num>=1000000){return(num/1000000).toFixed(0)+`&nbsp${dimension[2]}.`;}else if(num>=1000){return(num/1000).toFixed(0)+`&nbsp${dimension[1]}.`;}else{return num.toString();}}}function getMonthNameByIndex(index){const months=siteConfig.lexicon.months.split(',');if(index>=0&&index<months.length){return months[index];}else{return"Неверный индекс месяца";}}const goToMobileAppBtns=document.querySelectorAll('[data-mobile-app="open" ]');const mobileAppModal=$('[data-remodal-id="mobile-app-modal" ]').remodal();Array.prototype.forEach.call(goToMobileAppBtns,(btn)=>{btn.addEventListener('click',(e)=>{if(os=='Android'){if(siteConfig.forBusiness){window.location=siteConfig.playmarketBusiness;}else{window.location=siteConfig.playmarketPhysical;}}else if(os=='iOS'){if(siteConfig.forBusiness){window.location=siteConfig.appstoreBusiness;}else{window.
location=siteConfig.appstorePhysical;}}else{mobileAppModal.open();}});})
const clickEventsItems=document.querySelectorAll('[data-click-event]');clickEventsItems&&Array.prototype.forEach.call(clickEventsItems,(item)=>{item.addEventListener('click',()=>{sendEvent(siteConfig.pageAnalyticsTpl.replace('event',item.getAttribute('data-click-event')));})})